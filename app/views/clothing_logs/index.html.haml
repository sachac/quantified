%h1 Clothing log

= render "partials/clothing_log_entry"
= set_focus_to_id("#clothing")
- last_date = nil

%dl
  - @dates.each do |date|
    - list = @by_date[date]
    %dt= date
    - list.each do |item|
      %dd
        - if File.exist?("#{RAILS_ROOT}/public/images/clothing/small-#{item.clothing_id}.jpg")
          = link_to image_tag("clothing/small-#{item.clothing.number}.jpg"), item.clothing, :title => item.clothing.name
        - else
          = link_to item.clothing.name, clothing_path(item.clothing)
%table
  %tr
    - if user_signed_in?
      %th Wear
    %th Date
    %th ID
    %th Clothing
    - if user_signed_in?
      %th Edit
      %th Delete
    %th Colour
  - @clothing_logs.each do |clothing_log|
    - row_class = (clothing_log.date != last_date) ? "date-change" : ""
    - last_date = clothing_log.date  
    %tr{:class => row_class}
      - if user_signed_in?
        %td= link_to 'Wear today', clothing_logs_path + "?clothing_id=" + clothing_log.clothing_id.to_s + "&date=" + Date.today.to_s, :method => :post
      %td= link_to clothing_log.date, clothing_log
      %td= clothing_log.clothing.number
      %td= link_to clothing_log.clothing.name, clothing_path(clothing_log.clothing) unless clothing_log.clothing.nil?
      - if user_signed_in?
        %td= link_to 'Edit', edit_clothing_log_path(clothing_log)
        %td= link_to 'Delete', clothing_log, :confirm => 'Are you sure?', :method => :delete
      %td= render :partial => "partials/colours", :locals => { :colours => clothing_log.clothing.colour }
%br

= link_to 'New log entry', new_clothing_log_path
