= setup_page 'clothing', @clothing.name

- if user_signed_in?      
  = link_to 'Edit', edit_clothing_path(@clothing)
  \|
= link_to 'Back', clothing_index_path

- if managing?
  = form_tag clothing_logs_path do
    = hidden_field_tag :clothing_id, @clothing.id
    .inline
      = label_tag :date, 'Date'
      .input= text_field_tag :date, Date.today, :class => 'datepicker'
      = submit_tag 'Log', :class => 'btn primary'

%p
  = @clothing.status
  \|
  - if managing?
    - {'store' => 'stored', 'activate' => 'active', 'donate' => 'donated'}.each do |action,status|
      - unless status.nil? or @clothing.status == status
        = link_to action, clothing_path(@clothing.id) + '?clothing[status]=' + status, :method => :put


- if @clothing.image.file?
  .image
    - if managing?
      .instructions Click on a point in the image to save a color from the image.
      = form_tag save_clothing_color_path(@clothing) do
        = image_submit_tag @clothing.image.url(:large), :class => 'imagebtn'
    - else
      = clothing_thumbnail @clothing, :size => :large
      
%tags
  Tags:
  - @clothing.tags.each do |t|
    = link_to t.name, clothing_by_tag_path(t.name)
- unless @clothing.color.nil?
  - colors = @clothing.color.split(",")
  %table.auto
    %tr
      %td Color
      - colors.each do |x|
        %td.color
          .color-box{:style => "background: ##{x}"}
            = "#" + x
          = link_to image_tag('trash.png', :alt => t('general.delete'), :title => t('general.delete')), delete_clothing_color_path(@clothing.id, x), :method => :delete, :class => 'delete'
          
    %tr
      %td
        Complementary
      - colors.each do |x|
        - comp = Color::HSL.from_html(x).complementary.html
        %td
          .color-box{:style => "background: #{comp}"}
            = comp
    %tr
      %td Triadic:
      - colors.each do |x|
        - col = Color::HSL.from_html(x)
        %td
          - tr1 = col.clone
          - tr2 = col.clone
          - tr1.hue = tr1.hue + 120
          - tr2.hue = tr2.hue - 120
          .color-box{:style => "background: #{tr1.html}"}= tr1.html
          .color-box{:style => "background: #{tr2.html}"}= tr2.html

- if @previous_matches.size > 0
  .previous_matches= render :partial => 'clothing_thumbnails', :locals => { :list => @previous_matches }
- if @matches.size > 0
  .matches= render :partial => 'clothing_thumbnails', :locals => { :list => @matches }

%p= @clothing.notes

.clear-both
- if @logs
  - @logs.each do |c|
    .entry
      .date= current_user ? (link_to c.date, clothing_log_path(c)) : c.date
      .clothes
        - if c.date
          - current_account.clothing_logs.find(:all, :select => 'clothing_logs.id, clothing_id, clothing.name', :order => 'clothing.name', :joins => 'INNER JOIN clothing ON clothing_logs.clothing_id=clothing.id', :conditions => ["date >= ? and date < ? and outfit_id=?", c.date, c.date + 1.day, c.outfit_id]).each do |x| 
            .item= clothing_thumbnail x.clothing, {:size => :medium, :path => current_user ? clothing_log_path(x) : clothing_path(x.clothing)}

.clear-both
