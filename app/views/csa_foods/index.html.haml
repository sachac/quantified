%h1 Community-supported agriculture
.food.category
  - remaining = (current_account.csa_foods.where('disposition = ""').sum(:quantity) / 1000.0)
  - days = current_account.csa_foods.next_delivery - Date.today
  = link_to "#{'%0.1f' % remaining}kg of CSA food to go,", csa_foods_path
  = "#{pluralize days, "day"} until next delivery = "
  = "#{'%0.1f' % (remaining * 1.0 / days)}kg per day"
  
= form_tag bulk_update_csa_foods_path do
  - if can? :update, CsaFood
    = submit_tag 'Update'
  %table.lined
    %tr
      %th Date received
      %th Food
      %th Quantity
      %th Unit
      %th Disposition
      %th Notes
      %th

    - @csa_foods.each do |csa_food|
      %tr
        %td= link_to csa_food.date_received, csa_food
        %td= link_to csa_food.food.name, csa_food.food
        %td= csa_food.quantity
        %td= csa_food.unit
        %td
          - if can? :update, csa_food
            = text_field_tag "bulk[#{csa_food.id}]", csa_food.disposition
          - else
            = csa_food.disposition
        %td= csa_food.notes
        %td
          - if can?(:update, csa_food)
            = link_to 'Edit', edit_csa_food_path(csa_food)
%br

= link_to 'New Csa food', new_csa_food_path
