var a;Array.prototype.map||(Array.prototype.map=function(a,b){for(var c=this.length,d=new Array(c),e=0;e<c;e++)e in this&&(d[e]=a.call(b,this[e],e,this));return d}),Array.prototype.filter||(Array.prototype.filter=function(a,b){for(var c=this.length,d=[],e=0;e<c;e++)if(e in this){var f=this[e];a.call(b,f,e,this)&&d.push(f)}return d}),Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var c=this.length>>>0,d=0;d<c;d++)d in this&&a.call(b,this[d],d,this)}),Array.prototype.reduce||(Array.prototype.reduce=function(a,b){var c=this.length;if(!c&&arguments.length==1)throw new Error("reduce: empty array, no initial value");var d=0;if(arguments.length<2)for(;;){if(d in this){b=this[d++];break}if(++d>=c)throw new Error("reduce: no values, no initial value")}for(;d<c;d++)d in this&&(b=a(b,this[d],d,this));return b});var pv={};pv.version="3.3.1",pv.identity=function(a){return a},pv.index=function(){return this.index},pv.child=function(){return this.childIndex},pv.parent=function(){return this.parent.index},pv.extend=function(a){function b(){}return b.prototype=a.prototype||a,new b};try{eval("pv.parse = function(x) x;")}catch(e){pv.parse=function(a){for(var b=new RegExp("function\\s*(\\b\\w+)?\\s*\\([^)]*\\)\\s*","mg"),c,d,e=0,f="";c=b.exec(a);){c=c.index+c[0].length;if(a.charAt(c)!="{"){f+=a.substring(e,c)+"{return ",e=c;for(var g=0;g>=0&&c<a.length;c++){var h=a.charAt(c);switch(h){case'"':case"'":for(;++c<a.length&&(d=a.charAt(c))!=h;)d=="\\"&&c++;break;case"[":case"(":g++;break;case"]":case")":g--;break;case";":case",":g==0&&g--}}f+=pv.parse(a.substring(e,--c))+";}",e=c}b.lastIndex=c}return f+=a.substring(e),f}}pv.css=function(a,b){return window.getComputedStyle?window.getComputedStyle(a,null).getPropertyValue(b):a.currentStyle[b]},pv.error=function(a){typeof console=="undefined"?alert(a):console.error(a)},pv.listen=function(a,b,c){return c=pv.listener(c),a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)},pv.listener=function(a){return a.$listener||(a.$listener=function(c){try{return pv.event=c,a.call(this,c)}finally{delete pv.event}})},pv.ancestor=function(a,b){for(;b;){if(b==a)return!0;b=b.parentNode}return!1},pv.id=function(){var a=1;return function(){return a++}}(),pv.functor=function(a){return typeof a=="function"?a:function(){return a}},pv.listen(window,"load",function(){for(pv.$={i:0,x:document.getElementsByTagName("script")};pv.$.i<pv.$.x.length;pv.$.i++){pv.$.s=pv.$.x[pv.$.i];if(pv.$.s.type=="text/javascript+protovis")try{window.eval(pv.parse(pv.$.s.text))}catch(a){pv.error(a)}}delete pv.$}),pv.Format={},pv.Format.re=function(a){return a.replace(/[\\\^\$\*\+\?\[\]\(\)\.\{\}]/g,"\\$&")},pv.Format.pad=function(a,b,c){return b-=String(c).length,b<1?c:(new Array(b+1)).join(a)+c},pv.Format.date=function(a){function b(b){return a.replace(/%[a-zA-Z0-9]/g,function(a){switch(a){case"%a":return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][b.getDay()];case"%A":return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][b.getDay()];case"%h":case"%b":return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][b.getMonth()];case"%B":return["January","February","March","April","May","June","July","August","September","October","November","December"][b.getMonth()];case"%c":return b.toLocaleString();case"%C":return c("0",2,Math.floor(b.getFullYear()/100)%100);case"%d":return c("0",2,b.getDate());case"%x":case"%D":return c("0",2,b.getMonth()+1)+"/"+c("0",2,b.getDate())+"/"+c("0",2,b.getFullYear()%100);case"%e":return c(" ",2,b.getDate());case"%H":return c("0",2,b.getHours());case"%I":return(a=b.getHours()%12)?c("0",2,a):12;case"%m":return c("0",2,b.getMonth()+1);case"%M":return c("0",2,b.getMinutes());case"%n":return"\n";case"%p":return b.getHours()<12?"AM":"PM";case"%T":case"%X":case"%r":return a=b.getHours()%12,(a?c("0",2,a):12)+":"+c("0",2,b.getMinutes())+":"+c("0",2,b.getSeconds())+" "+(b.getHours()<12?"AM":"PM");case"%R":return c("0",2,b.getHours())+":"+c("0",2,b.getMinutes());case"%S":return c("0",2,b.getSeconds());case"%Q":return c("0",3,b.getMilliseconds());case"%t":return"\t";case"%u":return(a=b.getDay())?a:1;case"%w":return b.getDay();case"%y":return c("0",2,b.getFullYear()%100);case"%Y":return b.getFullYear();case"%%":return"%"}return a})}var c=pv.Format.pad;return b.format=b,b.parse=function(b){var c=1970,d=0,e=1,f=0,g=0,h=0,i=[function(){}],j=pv.Format.re(a).replace(/%[a-zA-Z0-9]/g,function(a){switch(a){case"%b":return i.push(function(a){d={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11}[a]}),"([A-Za-z]+)";case"%h":case"%B":return i.push(function(a){d={January:0,February:1,March:2,April:3,May:4,June:5,July:6,August:7,September:8,October:9,November:10,December:11}[a]}),"([A-Za-z]+)";case"%e":case"%d":return i.push(function(a){e=a}),"([0-9]+)";case"%I":case"%H":return i.push(function(a){f=a}),"([0-9]+)";case"%m":return i.push(function(a){d=a-1}),"([0-9]+)";case"%M":return i.push(function(a){g=a}),"([0-9]+)";case"%p":return i.push(function(a){f==12?a=="am"&&(f=0):a=="pm"&&(f=Number(f)+12)}),"(am|pm)";case"%S":return i.push(function(a){h=a}),"([0-9]+)";case"%y":return i.push(function(a){a=Number(a),c=a+(0<=a&&a<69?2e3:a>=69&&a<100?1900:0)}),"([0-9]+)";case"%Y":return i.push(function(a){c=a}),"([0-9]+)";case"%%":return i.push(function(){}),"%"}return a});return(b=b.match(j))&&b.forEach(function(a,b){i[b](a)}),new Date(c,d,e,f,g,h)},b},pv.Format.time=function(a){function b(b){b=Number(b);switch(a){case"short":if(b>=31536e6)return(b/31536e6).toFixed(1)+" years";if(b>=6048e5)return(b/6048e5).toFixed(1)+" weeks";if(b>=864e5)return(b/864e5).toFixed(1)+" days";if(b>=36e5)return(b/36e5).toFixed(1)+" hours";if(b>=6e4)return(b/6e4).toFixed(1)+" minutes";return(b/1e3).toFixed(1)+" seconds";case"long":var e=[],f=b%36e5/6e4>>0;e.push(c("0",2,b%6e4/1e3>>0));if(b>=36e5){var g=b%864e5/36e5>>0;e.push(c("0",2,f)),b>=864e5?(e.push(c("0",2,g)),e.push(Math.floor(b/864e5).toFixed())):e.push(g.toFixed())}else e.push(f.toFixed());return e.reverse().join(":")}}var c=pv.Format.pad;return b.format=b,b.parse=function(b){switch(a){case"short":for(var c=/([0-9,.]+)\s*([a-z]+)/g,d,e=0;d=c.exec(b);){var f=parseFloat(d[0].replace(",","")),g=0;switch(d[2].toLowerCase()){case"year":case"years":g=31536e6;break;case"week":case"weeks":g=6048e5;break;case"day":case"days":g=864e5;break;case"hour":case"hours":g=36e5;break;case"minute":case"minutes":g=6e4;break;case"second":case"seconds":g=1e3}e+=f*g}return e;case"long":return d=b.replace(",","").split(":").reverse(),e=0,d.length&&(e+=parseFloat(d[0])*1e3),d.length>1&&(e+=parseFloat(d[1])*6e4),d.length>2&&(e+=parseFloat(d[2])*36e5),d.length>3&&(e+=parseFloat(d[3])*864e5),e}},b},pv.Format.number=function(){function a(a){Infinity>f&&(a=Math.round(a*g)/g);var o=String(Math.abs(a)).split("."),r=o[0];return r.length>c&&(r=r.substring(r.length-c)),j&&r.length<b&&(r=(new Array(b-r.length+1)).join(h)+r),r.length>3&&(r=r.replace(/\B(?=(?:\d{3})+(?!\d))/g,l)),!j&&r.length<d&&(r=(new Array(d-r.length+1)).join(h)+r),o[0]=a<0?m+r+n:r,a=o[1]||"",a.length<e&&(o[1]=a+(new Array(e-a.length+1)).join(i)),o.join(k)}var b=0,c=Infinity,d=0,e=0,f=0,g=1,h="0",i="0",j=!0,k=".",l=",",m="âˆ’",n="";return a.format=a,a.parse=function(a){var b=pv.Format.re;return a=String(a).replace(new RegExp("^("+b(h)+")*"),"").replace(new RegExp("("+b(i)+")*$"),"").split(k),b=a[0].replace(new RegExp(b(l),"g"),""),b.length>c&&(b=b.substring(b.length-c)),a=a[1]?Number("0."+a[1]):0,Infinity>f&&(a=Math.round(a*g)/g),Math.round(b)+a},a.integerDigits=function(a,e){return arguments.length?(b=Number(a),c=arguments.length>1?Number(e):b,d=b+Math.floor(b/3)*l.length,this):[b,c]},a.fractionDigits=function(a,b){return arguments.length?(e=Number(a),f=arguments.length>1?Number(b):e,g=Math.pow(10,f),this):[e,f]},a.integerPad=function(a){return arguments.length?(h=String(a),j=/\d/.test(h),this):h},a.fractionPad=function(a){return arguments.length?(i=String(a),this):i},a.decimal=function(a){return arguments.length?(k=String(a),this):k},a.group=function(a){return arguments.length?(l=a?String(a):"",d=b+Math.floor(b/3)*l.length,this):l},a.negativeAffix=function(a,b){return arguments.length?(m=String(a||""),n=String(b||""),this):[m,n]},a},pv.map=function(a,b){var c={};return b?a.map(function(a,e){return c.index=e,b.call(c,a)}):a.slice()},pv.repeat=function(a,b){return arguments.length==1&&(b=2),pv.blend(pv.range(b).map(function(){return a}))},pv.cross=function(a,b){for(var c=[],d=0,e=a.length,f=b.length;d<e;d++)for(var g=0,h=a[d];g<f;g++)c.push([h,b[g]]);return c},pv.blend=function(a){return Array.prototype.concat.apply([],a)},pv.transpose=function(a){var b=a.length,c=pv.max(a,function(a){return a.length});if(c>b){a.length=c;for(var d=b;d<c;d++)a[d]=new Array(b);for(d=0;d<b;d++)for(var e=d+1;e<c;e++){var f=a[d][e];a[d][e]=a[e][d],a[e][d]=f}}else{for(d=0;d<c;d++)a[d].length=b;for(d=0;d<b;d++)for(e=0;e<d;e++)f=a[d][e],a[d][e]=a[e][d],a[e][d]=f}a.length=c;for(d=0;d<c;d++)a[d].length=b;return a},pv.normalize=function(a,b){a=pv.map(a,b),b=pv.sum(a);for(var c=0;c<a.length;c++)a[c]/=b;return a},pv.permute=function(a,b,c){c||(c=pv.identity);var d=new Array(b.length),e={};return b.forEach(function(b,h){e.index=b,d[h]=c.call(e,a[b])}),d},pv.numerate=function(a,b){b||(b=pv.identity);var c={},d={};return a.forEach(function(a,e){d.index=e,c[b.call(d,a)]=e}),c},pv.uniq=function(a,b){b||(b=pv.identity);var c={},d=[],e={},f;return a.forEach(function(a,i){e.index=i,f=b.call(e,a),f in c||(c[f]=d.push(f))}),d},pv.naturalOrder=function(a,b){return a<b?-1:a>b?1:0},pv.reverseOrder=function(a,b){return b<a?-1:b>a?1:0},pv.search=function(a,b,c){c||(c=pv.identity);for(var d=0,e=a.length-1;d<=e;){var f=d+e>>1,g=c(a[f]);if(g<b)d=f+1;else if(g>b)e=f-1;else return f}return-d-1},pv.search.index=function(a,b,c){return a=pv.search(a,b,c),a<0?-a-1:a},pv.range=function(a,b,c){arguments.length==1&&(b=a,a=0),c==undefined&&(c=1);if((b-a)/c==Infinity)throw new Error("range must be finite");var d=[],e=0,f;b-=(b-a)*1e-10;if(c<0)for(;(f=a+c*e++)>b;)d.push(f);else for(;(f=a+c*e++)<b;)d.push(f);return d},pv.random=function(a,b,c){return arguments.length==1&&(b=a,a=0),c==undefined&&(c=1),c?Math.floor(Math.random()*(b-a)/c)*c+a:Math.random()*(b-a)+a},pv.sum=function(a,b){var c={};return a.reduce(b?function(a,e,f){return c.index=f,a+b.call(c,e)}:function(a,b){return a+b},0)},pv.max=function(a,b){return b==pv.index?a.length-1:Math.max.apply(null,b?pv.map(a,b):a)},pv.max.index=function(a,b){if(!a.length)return-1;if(b==pv.index)return a.length-1;b||(b=pv.identity);for(var c=0,d=-Infinity,e={},f=0;f<a.length;f++){e.index=f;var g=b.call(e,a[f]);g>d&&(d=g,c=f)}return c},pv.min=function(a,b){return b==pv.index?0:Math.min.apply(null,b?pv.map(a,b):a)},pv.min.index=function(a,b){if(!a.length)return-1;if(b==pv.index)return 0;b||(b=pv.identity);for(var c=0,d=Infinity,e={},f=0;f<a.length;f++){e.index=f;var g=b.call(e,a[f]);g<d&&(d=g,c=f)}return c},pv.mean=function(a,b){return pv.sum(a,b)/a.length},pv.median=function(a,b){return b==pv.index?(a.length-1)/2:(a=pv.map(a,b).sort(pv.naturalOrder),a.length%2?a[Math.floor(a.length/2)]:(b=a.length/2,(a[b-1]+a[b])/2))},pv.variance=function(a,b){if(a.length<1)return NaN;if(a.length==1)return 0;var c=pv.mean(a,b),d=0,e={};b||(b=pv.identity);for(var f=0;f<a.length;f++){e.index=f;var g=b.call(e,a[f])-c;d+=g*g}return d},pv.deviation=function(a,b){return Math.sqrt(pv.variance(a,b)/(a.length-1))},pv.log=function(a,b){return Math.log(a)/Math.log(b)},pv.logSymmetric=function(a,b){return a==0?0:a<0?-pv.log(-a,b):pv.log(a,b)},pv.logAdjusted=function(a,b){if(!isFinite(a))return a;var c=a<0;return a<b&&(a+=(b-a)/b),c?-pv.log(a,b):pv.log(a,b)},pv.logFloor=function(a,b){return a>0?Math.pow(b,Math.floor(pv.log(a,b))):-Math.pow(b,-Math.floor(-pv.log(-a,b)))},pv.logCeil=function(a,b){return a>0?Math.pow(b,Math.ceil(pv.log(a,b))):-Math.pow(b,-Math.ceil(-pv.log(-a,b)))},function(){var a=Math.PI/180,b=180/Math.PI;pv.radians=function(b){return a*b},pv.degrees=function(a){return b*a}}(),pv.keys=function(a){var b=[];for(var c in a)b.push(c);return b},pv.entries=function(a){var b=[];for(var c in a)b.push({key:c,value:a[c]});return b},pv.values=function(a){var b=[];for(var c in a)b.push(a[c]);return b},pv.dict=function(a,b){for(var c={},d={},e=0;e<a.length;e++)if(e in a){var f=a[e];d.index=e,c[f]=b.call(d,f)}return c},pv.dom=function(a){return new pv.Dom(a)},pv.Dom=function(a){this.$map=a},pv.Dom.prototype.$leaf=function(a){return typeof a!="object"},pv.Dom.prototype.leaf=function(a){return arguments.length?(this.$leaf=a,this):this.$leaf},pv.Dom.prototype.root=function(a){function b(a){var d=new pv.Dom.Node;for(var e in a){var f=a[e];d.appendChild(c(f)?new pv.Dom.Node(f):b(f)).nodeName=e}return d}var c=this.$leaf,d=b(this.$map);return d.nodeName=a,d},pv.Dom.prototype.nodes=function(){return this.root().nodes()},pv.Dom.Node=function(a){this.nodeValue=a,this.childNodes=[]},a=pv.Dom.Node.prototype,a.parentNode=null,a.firstChild=null,a.lastChild=null,a.previousSibling=null,a.nextSibling=null,a.removeChild=function(a){var b=this.childNodes.indexOf(a);if(b==-1)throw new Error("child not found");return this.childNodes.splice(b,1),a.previousSibling?a.previousSibling.nextSibling=a.nextSibling:this.firstChild=a.nextSibling,a.nextSibling?a.nextSibling.previousSibling=a.previousSibling:this.lastChild=a.previousSibling,delete a.nextSibling,delete a.previousSibling,delete a.parentNode,a},a.appendChild=function(a){return a.parentNode&&a.parentNode.removeChild(a),a.parentNode=this,(a.previousSibling=this.lastChild)?this.lastChild.nextSibling=a:this.firstChild=a,this.lastChild=a,this.childNodes.push(a),a},a.insertBefore=function(a,b){if(!b)return this.appendChild(a);var c=this.childNodes.indexOf(b);if(c==-1)throw new Error("child not found");return a.parentNode&&a.parentNode.removeChild(a),a.parentNode=this,a.nextSibling=b,(a.previousSibling=b.previousSibling)?b.previousSibling.nextSibling=a:(b==this.lastChild&&(this.lastChild=a),this.firstChild=a),this.childNodes.splice(c,0,a),a},a.replaceChild=function(a,b){var c=this.childNodes.indexOf(b);if(c==-1)throw new Error("child not found");return a.parentNode&&a.parentNode.removeChild(a),a.parentNode=this,a.nextSibling=b.nextSibling,(a.previousSibling=b.previousSibling)?b.previousSibling.nextSibling=a:this.firstChild=a,b.nextSibling?b.nextSibling.previousSibling=a:this.lastChild=a,this.childNodes[c]=a,b},a.visitBefore=function(a){function b(d,e){a(d,e);for(d=d.firstChild;d;d=d.nextSibling)b(d,e+1)}b(this,0)},a.visitAfter=function(a){function b(d,e){for(var f=d.firstChild;f;f=f.nextSibling)b(f,e+1);a(d,e)}b(this,0)},a.sort=function(a){if(this.firstChild){this.childNodes.sort(a);var b=this.firstChild=this.childNodes[0],c;delete b.previousSibling;for(var d=1;d<this.childNodes.length;d++)b.sort(a),c=this.childNodes[d],c.previousSibling=b,b=b.nextSibling=c;this.lastChild=b,delete b.nextSibling,b.sort(a)}return this},a.reverse=function(){var a=[];return this.visitAfter(function(c){for(;c.lastChild;)a.push(c.removeChild(c.lastChild));for(var d;d=a.pop();)c.insertBefore(d,c.firstChild)}),this},a.nodes=function(){function a(d){b.push(d),d.childNodes.forEach(a)}var b=[];return a(this,b),b},a.toggle=function(a){if(a)return this.toggled?this.visitBefore(function(a){a.toggled&&a.toggle()}):this.visitAfter(function(a){a.toggled||a.toggle()});a=this;if(a.toggled){for(var b;b=a.toggled.pop();)a.appendChild(b);delete a.toggled}else if(a.lastChild)for(a.toggled=[];a.lastChild;)a.toggled.push(a.removeChild(a.lastChild))},pv.nodes=function(a){for(var b=new pv.Dom.Node,c=0;c<a.length;c++)b.appendChild(new pv.Dom.Node(a[c]));return b.nodes()},pv.tree=function(a){return new pv.Tree(a)},pv.Tree=function(a){this.array=a},pv.Tree.prototype.keys=function(a){return this.k=a,this},pv.Tree.prototype.value=function(a){return this.v=a,this},pv.Tree.prototype.map=function(){for(var a={},b={},c=0;c<this.array.length;c++){b.index=c;for(var d=this.array[c],e=this.k.call(b,d),f=a,g=0;g<e.length-1;g++)f=f[e[g]]||(f[e[g]]={});f[e[g]]=this.v?this.v.call(b,d):d}return a},pv.nest=function(a){return new pv.Nest(a)},pv.Nest=function(a){this.array=a,this.keys=[]},a=pv.Nest.prototype,a.key=function(a){return this.keys.push(a),this},a.sortKeys=function(a){return this.keys[this.keys.length-1].order=a||pv.naturalOrder,this},a.sortValues=function(a){return this.order=a||pv.naturalOrder,this},a.map=function(){for(var a={},b=[],c,d=0;d<this.array.length;d++){var e=this.array[d],f=a;for(c=0;c<this.keys.length-1;c++){var g=this.keys[c](e);f[g]||(f[g]={}),f=f[g]}g=this.keys[c](e),f[g]||(c=[],b.push(c),f[g]=c),f[g].push(e)}if(this.order)for(c=0;c<b.length;c++)b[c].sort(this.order);return a},a.entries=function(){function a(b){var c=[];for(var d in b){var e=b[d];c.push({key:d,values:e instanceof Array?e:a(e)})}return c}function b(a,d){var e=this.keys[d].order;e&&a.sort(function(a,b){return e(a.key,b.key)});if(++d<this.keys.length)for(var f=0;f<a.length;f++)b.call(this,a[f].values,d);return a}return b.call(this,a(this.map()),0)},a.rollup=function(a){function b(d){for(var e in d){var f=d[e];f instanceof Array?d[e]=a(f):b(f)}return d}return b(this.map())},pv.flatten=function(a){return new pv.Flatten(a)},pv.Flatten=function(a){this.map=a,this.keys=[]},pv.Flatten.prototype.key=function(a,b){return this.keys.push({name:a,value:b}),delete this.$leaf,this},pv.Flatten.prototype.leaf=function(a){return this.keys.length=0,this.$leaf=a,this},pv.Flatten.prototype.array=function(){function a(e,f){if(f<d.length-1)for(var g in e)c.push(g),a(e[g],f+1),c.pop();else b.push(c.concat(e))}var b=[],c=[],d=this.keys,e=this.$leaf;if(e){function f(a,d){if(e(a))b.push({keys:c.slice(),value:a});else for(var i in a)c.push(i),f(a[i],d+1),c.pop()}return f(this.map,0),b}return a(this.map,0),b.map(function(a){for(var b={},c=0;c<d.length;c++){var e=d[c],f=a[c];b[e.name]=e.value?e.value.call(null,f):f}return b})},pv.vector=function(a,b){return new pv.Vector(a,b)},pv.Vector=function(a,b){this.x=a,this.y=b},a=pv.Vector.prototype,a.perp=function(){return new pv.Vector(-this.y,this.x)},a.norm=function(){var a=this.length();return this.times(a?1/a:1)},a.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},a.times=function(a){return new pv.Vector(this.x*a,this.y*a)},a.plus=function(a,b){return arguments.length==1?new pv.Vector(this.x+a.x,this.y+a.y):new pv.Vector(this.x+a,this.y+b)},a.minus=function(a,b){return arguments.length==1?new pv.Vector(this.x-a.x,this.y-a.y):new pv.Vector(this.x-a,this.y-b)},a.dot=function(a,b){return arguments.length==1?this.x*a.x+this.y*a.y:this.x*a+this.y*b},pv.Transform=function(){},pv.Transform.prototype={k:1,x:0,y:0},pv.Transform.identity=new pv.Transform,pv.Transform.prototype.translate=function(a,b){var c=new pv.Transform;return c.k=this.k,c.x=this.k*a+this.x,c.y=this.k*b+this.y,c},pv.Transform.prototype.scale=function(a){var b=new pv.Transform;return b.k=this.k*a,b.x=this.x,b.y=this.y,b},pv.Transform.prototype.invert=function(){var a=new pv.Transform,b=1/this.k;return a.k=b,a.x=-this.x*b,a.y=-this.y*b,a},pv.Transform.prototype.times=function(a){var b=new pv.Transform;return b.k=this.k*a.k,b.x=this.k*a.x+this.x,b.y=this.k*a.y+this.y,b},pv.Scale=function(){},pv.Scale.interpolator=function(a,b){return typeof a=="number"?function(d){return d*(b-a)+a}:(a=pv.color(a).rgb(),b=pv.color(b).rgb(),function(d){var e=a.a*(1-d)+b.a*d;return e<1e-5&&(e=0),a.a==0?pv.rgb(b.r,b.g,b.b,e):b.a==0?pv.rgb(a.r,a.g,a.b,e):pv.rgb(Math.round(a.r*(1-d)+b.r*d),Math.round(a.g*(1-d)+b.g*d),Math.round(a.b*(1-d)+b.b*d),e)})},pv.Scale.quantitative=function(){function a(a){return new Date(a)}function b(a){var b=pv.search(c,a);return b<0&&(b=-b-2),b=Math.max(0,Math.min(f.length-1,b)),f[b]((i(a)-d[b])/(d[b+1]-d[b]))}var c=[0,1],d=[0,1],e=[0,1],f=[pv.identity],g=Number,h=!1,i=pv.identity,j=pv.identity,k=String;return b.transform=function(a,b){return i=function(b){return h?-a(-b):a(b)},j=function(a){return h?-b(-a):b(a)},d=c.map(i),this},b.domain=function(b,e,f){if(arguments.length){var j;return b instanceof Array?(arguments.length<2&&(e=pv.identity),arguments.length<3&&(f=e),j=b.length&&e(b[0]),c=b.length?[pv.min(b,e),pv.max(b,f)]:[]):(j=b,c=Array.prototype.slice.call(arguments).map(Number)),c.length?c.length==1&&(c=[c[0],c[0]]):c=[-Infinity,Infinity],h=(c[0]||c[c.length-1])<0,d=c.map(i),g=j instanceof Date?a:Number,this}return c.map(g)},b.range=function(){if(arguments.length){e=Array.prototype.slice.call(arguments),e.length?e.length==1&&(e=[e[0],e[0]]):e=[-Infinity,Infinity],f=[];for(var a=0;a<e.length-1;a++)f.push(pv.Scale.interpolator(e[a],e[a+1]));return this}return e},b.invert=function(a){var b=pv.search(e,a);return b<0&&(b=-b-2),b=Math.max(0,Math.min(f.length-1,b)),g(j(d[b]+(a-e[b])/(e[b+1]-e[b])*(d[b+1]-d[b])))},b.ticks=function(b){var d=c[0],e=c[c.length-1],f=e<d,h=f?e:d;e=f?d:e;var i=e-h;if(!i||!isFinite(i))return g==a&&(k=pv.Format.date("%x")),[g(h)];if(g==a){function j(a,b){switch(b){case 31536e6:a.setMonth(0);case 2592e6:a.setDate(1);case 6048e5:b==6048e5&&a.setDate(a.getDate()-a.getDay());case 864e5:a.setHours(0);case 36e5:a.setMinutes(0);case 6e4:a.setSeconds(0);case 1e3:a.setMilliseconds(0)}}var l,m,n=1;i>=94608e6?(d=31536e6,l="%Y",m=function(a){a.setFullYear(a.getFullYear()+n)}):i>=7776e6?(d=2592e6,l="%m/%Y",m=function(a){a.setMonth(a.getMonth()+n)}):i>=18144e5?(d=6048e5,l="%m/%d",m=function(a){a.setDate(a.getDate()+7*n)}):i>=2592e5?(d=864e5,l="%m/%d",m=function(a){a.setDate(a.getDate()+n)}):i>=108e5?(d=36e5,l="%I:%M %p",m=function(a){a.setHours(a.getHours()+n)}):i>=18e4?(d=6e4,l="%I:%M %p",m=function(a){a.setMinutes(a.getMinutes()+n)}):i>=3e3?(d=1e3,l="%I:%M:%S",m=function(a){a.setSeconds(a.getSeconds()+n)}):(d=1,l="%S.%Qs",m=function(a){a.setTime(a.getTime()+n)}),k=pv.Format.date(l),h=new Date(h),l=[],j(h,d),i/=d;if(i>10)switch(d){case 36e5:n=i>20?6:3,h.setHours(Math.floor(h.getHours()/n)*n);break;case 2592e6:n=3,h.setMonth(Math.floor(h.getMonth()/n)*n);break;case 6e4:n=i>30?15:i>15?10:5,h.setMinutes(Math.floor(h.getMinutes()/n)*n);break;case 1e3:n=i>90?15:i>60?10:5,h.setSeconds(Math.floor(h.getSeconds()/n)*n);break;case 1:n=i>1e3?250:i>200?100:i>100?50:i>50?25:5,h.setMilliseconds(Math.floor(h.getMilliseconds()/n)*n);break;default:n=pv.logCeil(i/15,10),i/n<2?n/=5:i/n<5&&(n/=2),h.setFullYear(Math.floor(h.getFullYear()/n)*n)}for(;;){m(h);if(h>e)break;l.push(new Date(h))}return f?l.reverse():l}return arguments.length||(b=10),n=pv.logFloor(i/b,10),d=b/(i/n),d<=.15?n*=10:d<=.35?n*=5:d<=.75&&(n*=2),d=Math.ceil(h/n)*n,e=Math.floor(e/n)*n,k=pv.Format.number().fractionDigits(Math.max(0,-Math.floor(pv.log(n,10)+.01))),e=pv.range(d,e+n,n),f?e.reverse():e},b.tickFormat=function(a){return k(a)},b.nice=function(){if(c.length!=2)return this;var a=c[0],b=c[c.length-1],e=b<a,f=e?b:a;return a=e?a:b,b=a-f,!b||!isFinite(b)?this:(b=Math.pow(10,Math.round(Math.log(b)/Math.log(10))-1),c=[Math.floor(f/b)*b,Math.ceil(a/b)*b],e&&c.reverse(),d=c.map(i),this)},b.by=function(a){function c(){return b(a.apply(this,arguments))}for(var d in b)c[d]=b[d];return c},b.domain.apply(b,arguments),b},pv.Scale.linear=function(){var a=pv.Scale.quantitative();return a.domain.apply(a,arguments),a},pv.Scale.log=function(){var a=pv.Scale.quantitative(1,10),b,c,d=function(a){return Math.log(a)/c},e=function(a){return Math.pow(b,a)};return a.ticks=function(){var c=a.domain(),h=c[0]<0,i=Math.floor(h?-d(-c[0]):d(c[0])),j=Math.ceil(h?-d(-c[1]):d(c[1])),k=[];if(h)for(k.push(-e(-i));i++<j;)for(h=b-1;h>0;h--)k.push(-e(-i)*h);else{for(;i<j;i++)for(h=1;h<b;h++)k.push(e(i)*h);k.push(e(i))}for(i=0;k[i]<c[0];i++);for(j=k.length;k[j-1]>c[1];j--);return k.slice(i,j)},a.tickFormat=function(a){return a.toPrecision(1)},a.nice=function(){var c=a.domain();return a.domain(pv.logFloor(c[0],b),pv.logCeil(c[1],b))},a.base=function(h){return arguments.length?(b=Number(h),c=Math.log(b),a.transform(d,e),this):b},a.domain.apply(a,arguments),a.base(10)},pv.Scale.root=function(){var a=pv.Scale.quantitative();return a.power=function(c){if(arguments.length){var d=Number(c),e=1/d;return a.transform(function(a){return Math.pow(a,e)},function(a){return Math.pow(a,d)}),this}return d},a.domain.apply(a,arguments),a.power(2)},pv.Scale.ordinal=function(){function a(a){return a in c||(c[a]=b.push(a)-1),d[c[a]%d.length]}var b=[],c={},d=[];return a.domain=function(a,d){if(arguments.length){a=a instanceof Array?arguments.length>1?pv.map(a,d):a:Array.prototype.slice.call(arguments),b=[];for(var e={},f=0;f<a.length;f++){var g=a[f];g in e||(e[g]=!0,b.push(g))}return c=pv.numerate(b),this}return b},a.range=function(a,b){return arguments.length?(d=a instanceof Array?arguments.length>1?pv.map(a,b):a:Array.prototype.slice.call(arguments),typeof d[0]=="string"&&(d=d.map(pv.color)),this):d},a.split=function(a,b){var c=(b-a)/this.domain().length;return d=pv.range(a+c/2,b,c),this},a.splitFlush=function(a,b){var c=this.domain().length,e=(b-a)/(c-1);return d=c==1?[(a+b)/2]:pv.range(a,b+e/2,e),this},a.splitBanded=function(a,b,c){arguments.length<3&&(c=1);if(c<0){var e=this.domain().length;e=(b-a- -c*e)/(e+1),d=pv.range(a+e,b,e-c),d.band=-c}else e=(b-a)/(this.domain().length+(1-c)),d=pv.range(a+e*(1-c),b,e),d.band=e*c;return this},a.by=function(b){function c(){return a(b.apply(this,arguments))}for(var d in a)c[d]=a[d];return c},a.domain.apply(a,arguments),a},pv.Scale.quantile=function(){function a(a){return f(Math.max(0,Math.min(c,pv.search.index(d,a)-1))/c)}var b=-1,c=-1,d=[],e=[],f=pv.Scale.linear();return a.quantiles=function(a){if(arguments.length){b=Number(a);if(b<0)d=[e[0]].concat(e),c=e.length-1;else{d=[],d[0]=e[0];for(var f=1;f<=b;f++)d[f]=e[~~(f*(e.length-1)/b)];c=b-1}return this}return d},a.domain=function(c,d){return arguments.length?(e=c instanceof Array?pv.map(c,d):Array.prototype.slice.call(arguments),e.sort(pv.naturalOrder),a.quantiles(b),this):e},a.range=function(){return arguments.length?(f.range.apply(f,arguments),this):f.range()},a.by=function(b){function c(){return a(b.apply(this,arguments))}for(var d in a)c[d]=a[d];return c},a.domain.apply(a,arguments),a},pv.histogram=function(a,b){var c=!0;return{bins:function(e){var f=pv.map(a,b),g=[];arguments.length||(e=pv.Scale.linear(f).ticks());for(var h=0;h<e.length-1;h++){var i=g[h]=[];i.x=e[h],i.dx=e[h+1]-e[h],i.y=0}for(h=0;h<f.length;h++)i=pv.search.index(e,f[h])-1,i=g[Math.max(0,Math.min(g.length-1,i))],i.y++,i.push(a[h]);if(!c)for(h=0;h<g.length;h++)g[h].y/=f.length;return g},frequency:function(a){return arguments.length?(c=Boolean(a),this):c}}},pv.color=function(a){if(a.rgb)return a.rgb();var b=/([a-z]+)\((.*)\)/i.exec(a);if(b){var c=b[2].split(","),d=1;switch(b[1]){case"hsla":case"rgba":d=parseFloat(c[3]);if(!d)return pv.Color.transparent}switch(b[1]){case"hsla":case"hsl":a=parseFloat(c[0]);var e=parseFloat(c[1])/100;return c=parseFloat(c[2])/100,(new pv.Color.Hsl(a,e,c,d)).rgb();case"rgba":case"rgb":function f(a){var b=parseFloat(a);return a[a.length-1]=="%"?Math.round(b*2.55):b}e=f(c[0]);var g=f(c[1]),h=f(c[2]);return pv.rgb(e,g,h,d)}}return(d=pv.Color.names[a])?d:a.charAt(0)=="#"?(a.length==4?(e=a.charAt(1),e+=e,g=a.charAt(2),g+=g,h=a.charAt(3),h+=h):a.length==7&&(e=a.substring(1,3),g=a.substring(3,5),h=a.substring(5,7)),pv.rgb(parseInt(e,16),parseInt(g,16),parseInt(h,16),1)):new pv.Color(a,1)},pv.Color=function(a,b){this.color=a,this.opacity=b},pv.Color.prototype.brighter=function(a){return this.rgb().brighter(a)},pv.Color.prototype.darker=function(a){return this.rgb().darker(a)},pv.rgb=function(a,b,c,d){return new pv.Color.Rgb(a,b,c,arguments.length==4?d:1)},pv.Color.Rgb=function(a,b,c,d){pv.Color.call(this,d?"rgb("+a+","+b+","+c+")":"none",d),this.r=a,this.g=b,this.b=c,this.a=d},pv.Color.Rgb.prototype=pv.extend(pv.Color),a=pv.Color.Rgb.prototype,a.red=function(a){return pv.rgb(a,this.g,this.b,this.a)},a.green=function(a){return pv.rgb(this.r,a,this.b,this.a)},a.blue=function(a){return pv.rgb(this.r,this.g,a,this.a)},a.alpha=function(a){return pv.rgb(this.r,this.g,this.b,a)},a.rgb=function(){return this},a.brighter=function(a){a=Math.pow(.7,arguments.length?a:1);var b=this.r,c=this.g,d=this.b;return!b&&!c&&!d?pv.rgb(30,30,30,this.a):(b&&b<30&&(b=30),c&&c<30&&(c=30),d&&d<30&&(d=30),pv.rgb(Math.min(255,Math.floor(b/a)),Math.min(255,Math.floor(c/a)),Math.min(255,Math.floor(d/a)),this.a))},a.darker=function(a){return a=Math.pow(.7,arguments.length?a:1),pv.rgb(Math.max(0,Math.floor(a*this.r)),Math.max(0,Math.floor(a*this.g)),Math.max(0,Math.floor(a*this.b)),this.a)},pv.hsl=function(a,b,c,d){return new pv.Color.Hsl(a,b,c,arguments.length==4?d:1)},pv.Color.Hsl=function(a,b,c,d){pv.Color.call(this,"hsl("+a+","+b*100+"%,"+c*100+"%)",d),this.h=a,this.s=b,this.l=c,this.a=d},pv.Color.Hsl.prototype=pv.extend(pv.Color),a=pv.Color.Hsl.prototype,a.hue=function(a){return pv.hsl(a,this.s,this.l,this.a)},a.saturation=function(a){return pv.hsl(this.h,a,this.l,this.a)},a.lightness=function(a){return pv.hsl(this.h,this.s,a,this.a)},a.alpha=function(a){return pv.hsl(this.h,this.s,this.l,a)},a.rgb=function(){function a(a){return a>360?a-=360:a<0&&(a+=360),a<60?g+(f-g)*a/60:a<180?f:a<240?g+(f-g)*(240-a)/60:g}function b(b){return Math.round(a(b)*255)}var c=this.h,d=this.s,e=this.l;c%=360,c<0&&(c+=360),d=Math.max(0,Math.min(d,1)),e=Math.max(0,Math.min(e,1));var f=e<=.5?e*(1+d):e+d-e*d,g=2*e-f;return pv.rgb(b(c+120),b(c),b(c-120),this.a)},pv.Color.names={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:pv.Color.transparent=pv.rgb(0,0,0,0)},function(){var a=pv.Color.names;for(var b in a)a[b]=pv.color(a[b])}(),pv.colors=function(){var a=pv.Scale.ordinal();return a.range.apply(a,arguments),a},pv.Colors={},pv.Colors.category10=function(){var a=pv.colors("#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf");return a.domain.apply(a,arguments),a},pv.Colors.category20=function(){var a=pv.colors("#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd"
,"#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5");return a.domain.apply(a,arguments),a},pv.Colors.category19=function(){var a=pv.colors("#9c9ede","#7375b5","#4a5584","#cedb9c","#b5cf6b","#8ca252","#637939","#e7cb94","#e7ba52","#bd9e39","#8c6d31","#e7969c","#d6616b","#ad494a","#843c39","#de9ed6","#ce6dbd","#a55194","#7b4173");return a.domain.apply(a,arguments),a},pv.ramp=function(){var a=pv.Scale.linear();return a.range.apply(a,arguments),a},pv.Scene=pv.SvgScene={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns",xlink:"http://www.w3.org/1999/xlink",xhtml:"http://www.w3.org/1999/xhtml",scale:1,events:["DOMMouseScroll","mousewheel","mousedown","mouseup","mouseover","mouseout","mousemove","click","dblclick"],implicit:{svg:{"shape-rendering":"auto","pointer-events":"painted",x:0,y:0,dy:0,"text-anchor":"start",transform:"translate(0,0)",fill:"none","fill-opacity":1,stroke:"none","stroke-opacity":1,"stroke-width":1.5,"stroke-linejoin":"miter"},css:{font:"10px sans-serif"}}},pv.SvgScene.updateAll=function(a){if(a.length&&a[0].reverse&&a.type!="line"&&a.type!="area"){for(var b=pv.extend(a),c=0,d=a.length-1;d>=0;c++,d--)b[c]=a[d];a=b}this.removeSiblings(this[a.type](a))},pv.SvgScene.create=function(a){return document.createElementNS(this.svg,a)},pv.SvgScene.expect=function(a,b,c,d){a?(a.tagName=="a"&&(a=a.firstChild),a.tagName!=b&&(b=this.create(b),a.parentNode.replaceChild(b,a),a=b)):a=this.create(b);for(var e in c)b=c[e],b==this.implicit.svg[e]&&(b=null),b==null?a.removeAttribute(e):a.setAttribute(e,b);for(e in d)b=d[e],b==this.implicit.css[e]&&(b=null),b==null?a.style.removeProperty(e):a.style[e]=b;return a},pv.SvgScene.append=function(a,b,c){return a.$scene={scenes:b,index:c},a=this.title(a,b[c]),a.parentNode||b.$g.appendChild(a),a.nextSibling},pv.SvgScene.title=function(a,b){var c=a.parentNode;return c&&c.tagName!="a"&&(c=null),b.title?(c||(c=this.create("a"),a.parentNode&&a.parentNode.replaceChild(c,a),c.appendChild(a)),c.setAttributeNS(this.xlink,"title",b.title),c):(c&&c.parentNode.replaceChild(a,c),a)},pv.SvgScene.dispatch=pv.listener(function(a){var b=a.target.$scene;if(b){var c=a.type;switch(c){case"DOMMouseScroll":c="mousewheel",a.wheel=-480*a.detail;break;case"mousewheel":a.wheel=(window.opera?12:1)*a.wheelDelta}pv.Mark.dispatch(c,b.scenes,b.index)&&a.preventDefault()}}),pv.SvgScene.removeSiblings=function(a){for(;a;){var b=a.nextSibling;a.parentNode.removeChild(a),a=b}},pv.SvgScene.undefined=function(){},pv.SvgScene.pathBasis=function(){function a(a,b,c,d,e){return{x:a[0]*b.left+a[1]*c.left+a[2]*d.left+a[3]*e.left,y:a[0]*b.top+a[1]*c.top+a[2]*d.top+a[3]*e.top}}var b=[[1/6,2/3,1/6,0],[0,2/3,1/3,0],[0,1/3,2/3,0],[0,1/6,2/3,1/6]],c=function(c,d,e,f){var g=a(b[1],c,d,e,f),h=a(b[2],c,d,e,f);return c=a(b[3],c,d,e,f),"C"+g.x+","+g.y+","+h.x+","+h.y+","+c.x+","+c.y};return c.segment=function(c,d,e,f){var g=a(b[0],c,d,e,f),h=a(b[1],c,d,e,f),i=a(b[2],c,d,e,f);return c=a(b[3],c,d,e,f),"M"+g.x+","+g.y+"C"+h.x+","+h.y+","+i.x+","+i.y+","+c.x+","+c.y},c}(),pv.SvgScene.curveBasis=function(a){if(a.length<=2)return"";var b="",c=a[0],d=c,e=c,f=a[1];b+=this.pathBasis(c,d,e,f);for(var g=2;g<a.length;g++)c=d,d=e,e=f,f=a[g],b+=this.pathBasis(c,d,e,f);return b+=this.pathBasis(d,e,f,f),b+=this.pathBasis(e,f,f,f),b},pv.SvgScene.curveBasisSegments=function(a){if(a.length<=2)return"";var b=[],c=a[0],d=c,e=c,f=a[1],g=this.pathBasis.segment(c,d,e,f);c=d,d=e,e=f,f=a[2],b.push(g+this.pathBasis(c,d,e,f));for(g=3;g<a.length;g++)c=d,d=e,e=f,f=a[g],b.push(this.pathBasis.segment(c,d,e,f));return b.push(this.pathBasis.segment(d,e,f,f)+this.pathBasis(e,f,f,f)),b},pv.SvgScene.curveHermite=function(a,b){if(b.length<1||a.length!=b.length&&a.length!=b.length+2)return"";var c=a.length!=b.length,d="",e=a[0],f=a[1],g=b[0],h=g,i=1;c&&(d+="Q"+(f.left-g.x*2/3)+","+(f.top-g.y*2/3)+","+f.left+","+f.top,e=a[1],i=2);if(b.length>1){h=b[1],f=a[i],i++,d+="C"+(e.left+g.x)+","+(e.top+g.y)+","+(f.left-h.x)+","+(f.top-h.y)+","+f.left+","+f.top;for(e=2;e<b.length;e++,i++)f=a[i],h=b[e],d+="S"+(f.left-h.x)+","+(f.top-h.y)+","+f.left+","+f.top}return c&&(a=a[i],d+="Q"+(f.left+h.x*2/3)+","+(f.top+h.y*2/3)+","+a.left+","+a.top),d},pv.SvgScene.curveHermiteSegments=function(a,b){if(b.length<1||a.length!=b.length&&a.length!=b.length+2)return[];var c=a.length!=b.length,d=[],e=a[0],f=e,g=b[0],h=g,i=1;c&&(f=a[1],d.push("M"+e.left+","+e.top+"Q"+(f.left-h.x*2/3)+","+(f.top-h.y*2/3)+","+f.left+","+f.top),i=2);for(var j=1;j<b.length;j++,i++)e=f,g=h,f=a[i],h=b[j],d.push("M"+e.left+","+e.top+"C"+(e.left+g.x)+","+(e.top+g.y)+","+(f.left-h.x)+","+(f.top-h.y)+","+f.left+","+f.top);return c&&(a=a[i],d.push("M"+f.left+","+f.top+"Q"+(f.left+h.x*2/3)+","+(f.top+h.y*2/3)+","+a.left+","+a.top)),d},pv.SvgScene.cardinalTangents=function(a,b){var c=[];b=(1-b)/2;for(var d=a[0],e=a[1],f=a[2],g=3;g<a.length;g++)c.push({x:b*(f.left-d.left),y:b*(f.top-d.top)}),d=e,e=f,f=a[g];return c.push({x:b*(f.left-d.left),y:b*(f.top-d.top)}),c},pv.SvgScene.curveCardinal=function(a,b){return a.length<=2?"":this.curveHermite(a,this.cardinalTangents(a,b))},pv.SvgScene.curveCardinalSegments=function(a,b){return a.length<=2?"":this.curveHermiteSegments(a,this.cardinalTangents(a,b))},pv.SvgScene.monotoneTangents=function(a){var b=[],c=[],d=[],e=[],f=0;for(f=0;f<a.length-1;f++)c[f]=(a[f+1].top-a[f].top)/(a[f+1].left-a[f].left);d[0]=c[0],e[0]=a[1].left-a[0].left;for(f=1;f<a.length-1;f++)d[f]=(c[f-1]+c[f])/2,e[f]=(a[f+1].left-a[f-1].left)/2;d[f]=c[f-1],e[f]=a[f].left-a[f-1].left;for(f=0;f<a.length-1;f++)c[f]==0&&(d[f]=0,d[f+1]=0);for(f=0;f<a.length-1;f++)if(!(Math.abs(d[f])<1e-5||Math.abs(d[f+1])<1e-5)){var g=d[f]/c[f],h=d[f+1]/c[f],i=g*g+h*h;i>9&&(i=3/Math.sqrt(i),d[f]=i*g*c[f],d[f+1]=i*h*c[f])}for(f=0;f<a.length;f++)c=1+d[f]*d[f],b.push({x:e[f]/3/c,y:d[f]*e[f]/3/c});return b},pv.SvgScene.curveMonotone=function(a){return a.length<=2?"":this.curveHermite(a,this.monotoneTangents(a))},pv.SvgScene.curveMonotoneSegments=function(a){return a.length<=2?"":this.curveHermiteSegments(a,this.monotoneTangents(a))},pv.SvgScene.area=function(a){function b(b,c){for(var d=[],f=[],g=c;b<=g;b++,c--){var h=a[b],i=a[c];h=h.left+","+h.top,i=i.left+i.width+","+(i.top+i.height);if(b<g){var j=a[b+1],k=a[c-1];switch(e.interpolate){case"step-before":h+="V"+j.top,i+="H"+(k.left+k.width);break;case"step-after":h+="H"+j.left,i+="V"+(k.top+k.height)}}d.push(h),f.push(i)}return d.concat(f).join("L")}function c(b,c){for(var d=[],f=[],g=c;b<=g;b++,c--){var h=a[c];d.push(a[b]),f.push({left:h.left+h.width,top:h.top+h.height})}return e.interpolate=="basis"?(b=pv.SvgScene.curveBasis(d),c=pv.SvgScene.curveBasis(f)):e.interpolate=="cardinal"?(b=pv.SvgScene.curveCardinal(d,e.tension),c=pv.SvgScene.curveCardinal(f,e.tension)):(b=pv.SvgScene.curveMonotone(d),c=pv.SvgScene.curveMonotone(f)),d[0].left+","+d[0].top+b+"L"+f[0].left+","+f[0].top+c}var d=a.$g.firstChild;if(!a.length)return d;var e=a[0];if(e.segmented)return this.areaSegment(a);if(!e.visible)return d;var f=e.fillStyle,g=e.strokeStyle;if(!f.opacity&&!g.opacity)return d;for(var h=[],i,j=0;j<a.length;j++){i=a[j];if(i.width||i.height){for(var k=j+1;k<a.length;k++){i=a[k];if(!i.width&&!i.height)break}j&&e.interpolate!="step-after"&&j--,k<a.length&&e.interpolate!="step-before"&&k++,h.push((k-j>2&&(e.interpolate=="basis"||e.interpolate=="cardinal"||e.interpolate=="monotone")?c:b)(j,k-1)),j=k-1}}return h.length?(d=this.expect(d,"path",{"shape-rendering":e.antialias?null:"crispEdges","pointer-events":e.events,cursor:e.cursor,d:"M"+h.join("ZM")+"Z",fill:f.color,"fill-opacity":f.opacity||null,stroke:g.color,"stroke-opacity":g.opacity||null,"stroke-width":g.opacity?e.lineWidth/this.scale:null}),this.append(d,a,0)):d},pv.SvgScene.areaSegment=function(a){var b=a.$g.firstChild,c=a[0],d,e;if(c.interpolate=="basis"||c.interpolate=="cardinal"||c.interpolate=="monotone"){d=[],e=[];for(var f=0,g=a.length;f<g;f++){var h=a[g-f-1];d.push(a[f]),e.push({left:h.left+h.width,top:h.top+h.height})}c.interpolate=="basis"?(d=this.curveBasisSegments(d),e=this.curveBasisSegments(e)):c.interpolate=="cardinal"?(d=this.curveCardinalSegments(d,c.tension),e=this.curveCardinalSegments(e,c.tension)):(d=this.curveMonotoneSegments(d),e=this.curveMonotoneSegments(e))}f=0;for(g=a.length-1;f<g;f++){c=a[f];var i=a[f+1];if(c.visible&&i.visible){var j=c.fillStyle,k=c.strokeStyle;if(j.opacity||k.opacity){if(d)h=d[f],i="L"+e[g-f-1].substr(1),h=h+i+"Z";else{var l=c;h=i;switch(c.interpolate){case"step-before":l=i;break;case"step-after":h=c}h="M"+c.left+","+l.top+"L"+i.left+","+h.top+"L"+(i.left+i.width)+","+(h.top+h.height)+"L"+(c.left+c.width)+","+(l.top+l.height)+"Z"}b=this.expect(b,"path",{"shape-rendering":c.antialias?null:"crispEdges","pointer-events":c.events,cursor:c.cursor,d:h,fill:j.color,"fill-opacity":j.opacity||null,stroke:k.color,"stroke-opacity":k.opacity||null,"stroke-width":k.opacity?c.lineWidth/this.scale:null}),b=this.append(b,a,f)}}}return b},pv.SvgScene.bar=function(a){for(var b=a.$g.firstChild,c=0;c<a.length;c++){var d=a[c];if(d.visible){var e=d.fillStyle,f=d.strokeStyle;if(e.opacity||f.opacity)b=this.expect(b,"rect",{"shape-rendering":d.antialias?null:"crispEdges","pointer-events":d.events,cursor:d.cursor,x:d.left,y:d.top,width:Math.max(1e-10,d.width),height:Math.max(1e-10,d.height),fill:e.color,"fill-opacity":e.opacity||null,stroke:f.color,"stroke-opacity":f.opacity||null,"stroke-width":f.opacity?d.lineWidth/this.scale:null}),b=this.append(b,a,c)}}return b},pv.SvgScene.dot=function(a){for(var b=a.$g.firstChild,c=0;c<a.length;c++){var d=a[c];if(d.visible){var e=d.fillStyle,f=d.strokeStyle;if(e.opacity||f.opacity){var g=d.radius,h=null;switch(d.shape){case"cross":h="M"+ -g+","+ -g+"L"+g+","+g+"M"+g+","+ -g+"L"+ -g+","+g;break;case"triangle":h=g;var i=g*1.1547;h="M0,"+h+"L"+i+","+ -h+" "+ -i+","+ -h+"Z";break;case"diamond":g*=Math.SQRT2,h="M0,"+ -g+"L"+g+",0 0,"+g+" "+ -g+",0Z";break;case"square":h="M"+ -g+","+ -g+"L"+g+","+ -g+" "+g+","+g+" "+ -g+","+g+"Z";break;case"tick":h="M0,0L0,"+ -d.size;break;case"bar":h="M0,"+d.size/2+"L0,"+ -(d.size/2)}e={"shape-rendering":d.antialias?null:"crispEdges","pointer-events":d.events,cursor:d.cursor,fill:e.color,"fill-opacity":e.opacity||null,stroke:f.color,"stroke-opacity":f.opacity||null,"stroke-width":f.opacity?d.lineWidth/this.scale:null},h?(e.transform="translate("+d.left+","+d.top+")",d.angle&&(e.transform+=" rotate("+180*d.angle/Math.PI+")"),e.d=h,b=this.expect(b,"path",e)):(e.cx=d.left,e.cy=d.top,e.r=g,b=this.expect(b,"circle",e)),b=this.append(b,a,c)}}}return b},pv.SvgScene.image=function(a){for(var b=a.$g.firstChild,c=0;c<a.length;c++){var d=a[c];if(d.visible){b=this.fill(b,a,c);if(d.image){b=this.expect(b,"foreignObject",{cursor:d.cursor,x:d.left,y:d.top,width:d.width,height:d.height});var e=b.firstChild||b.appendChild(document.createElementNS(this.xhtml,"canvas"));e.$scene={scenes:a,index:c},e.style.width=d.width,e.style.height=d.height,e.width=d.imageWidth,e.height=d.imageHeight,e.getContext("2d").putImageData(d.image,0,0)}else b=this.expect(b,"image",{preserveAspectRatio:"none",cursor:d.cursor,x:d.left,y:d.top,width:d.width,height:d.height}),b.setAttributeNS(this.xlink,"href",d.url);b=this.append(b,a,c),b=this.stroke(b,a,c)}}return b},pv.SvgScene.label=function(a){for(var b=a.$g.firstChild,c=0;c<a.length;c++){var d=a[c];if(d.visible){var e=d.textStyle;if(e.opacity&&d.text){var f=0,g=0,h=0,i="start";switch(d.textBaseline){case"middle":h=".35em";break;case"top":h=".71em",g=d.textMargin;break;case"bottom":g="-"+d.textMargin}switch(d.textAlign){case"right":i="end",f="-"+d.textMargin;break;case"center":i="middle";break;case"left":f=d.textMargin}b=this.expect(b,"text",{"pointer-events":d.events,cursor:d.cursor,x:f,y:g,dy:h,transform:"translate("+d.left+","+d.top+")"+(d.textAngle?" rotate("+180*d.textAngle/Math.PI+")":"")+(this.scale!=1?" scale("+1/this.scale+")":""),fill:e.color,"fill-opacity":e.opacity||null,"text-anchor":i},{font:d.font,"text-shadow":d.textShadow,"text-decoration":d.textDecoration}),b.firstChild?b.firstChild.nodeValue=d.text:b.appendChild(document.createTextNode(d.text)),b=this.append(b,a,c)}}}return b},pv.SvgScene.line=function(a){var b=a.$g.firstChild;if(a.length<2)return b;var c=a[0];if(c.segmented)return this.lineSegment(a);if(!c.visible)return b;var d=c.fillStyle,e=c.strokeStyle;if(!d.opacity&&!e.opacity)return b;var f="M"+c.left+","+c.top;if(a.length>2&&(c.interpolate=="basis"||c.interpolate=="cardinal"||c.interpolate=="monotone"))switch(c.interpolate){case"basis":f+=this.curveBasis(a);break;case"cardinal":f+=this.curveCardinal(a,c.tension);break;case"monotone":f+=this.curveMonotone(a)}else for(var g=1;g<a.length;g++)f+=this.pathSegment(a[g-1],a[g]);return b=this.expect(b,"path",{"shape-rendering":c.antialias?null:"crispEdges","pointer-events":c.events,cursor:c.cursor,d:f,fill:d.color,"fill-opacity":d.opacity||null,stroke:e.color,"stroke-opacity":e.opacity||null,"stroke-width":e.opacity?c.lineWidth/this.scale:null,"stroke-linejoin":c.lineJoin}),this.append(b,a,0)},pv.SvgScene.lineSegment=function(a){var b=a.$g.firstChild,c=a[0],d;switch(c.interpolate){case"basis":d=this.curveBasisSegments(a);break;case"cardinal":d=this.curveCardinalSegments(a,c.tension);break;case"monotone":d=this.curveMonotoneSegments(a)}c=0;for(var e=a.length-1;c<e;c++){var f=a[c],g=a[c+1];if(f.visible&&g.visible){var h=f.strokeStyle,i=pv.Color.transparent;h.opacity&&(f.interpolate=="linear"&&f.lineJoin=="miter"?(i=h,h=pv.Color.transparent,g=this.pathJoin(a[c-1],f,g,a[c+2])):g=d?d[c]:"M"+f.left+","+f.top+this.pathSegment(f,g),b=this.expect(b,"path",{"shape-rendering":f.antialias?null:"crispEdges","pointer-events":f.events,cursor:f.cursor,d:g,fill:i.color,"fill-opacity":i.opacity||null,stroke:h.color,"stroke-opacity":h.opacity||null,"stroke-width":h.opacity?f.lineWidth/this.scale:null,"stroke-linejoin":f.lineJoin}),b=this.append(b,a,c))}}return b},pv.SvgScene.pathSegment=function(a,b){var c=1;switch(a.interpolate){case"polar-reverse":c=0;case"polar":var d=b.left-a.left,e=b.top-a.top;a=1-a.eccentricity,d=Math.sqrt(d*d+e*e)/(2*a);if(a<=0||a>1)break;return"A"+d+","+d+" 0 0,"+c+" "+b.left+","+b.top;case"step-before":return"V"+b.top+"H"+b.left;case"step-after":return"H"+b.left+"V"+b.top}return"L"+b.left+","+b.top},pv.SvgScene.lineIntersect=function(a,b,c,d){return a.plus(b.times(c.minus(a).dot(d.perp())/b.dot(d.perp())))},pv.SvgScene.pathJoin=function(a,b,c,d){var e=pv.vector(b.left,b.top);c=pv.vector(c.left,c.top);var f=c.minus(e),g=f.perp().norm(),h=g.times(b.lineWidth/(2*this.scale));b=e.plus(h);var i=c.plus(h),j=c.minus(h);return h=e.minus(h),a&&a.visible&&(a=e.minus(a.left,a.top).perp().norm().plus(g),h=this.lineIntersect(e,a,h,f),b=this.lineIntersect(e,a,b,f)),d&&d.visible&&(d=pv.vector(d.left,d.top).minus(c).perp().norm().plus(g),j=this.lineIntersect(c,d,j,f),i=this.lineIntersect(c,d,i,f)),"M"+b.x+","+b.y+"L"+i.x+","+i.y+" "+j.x+","+j.y+" "+h.x+","+h.y},pv.SvgScene.panel=function(a){for(var b=a.$g,c=b&&b.firstChild,d=0;d<a.length;d++){var e=a[d];if(e.visible){if(!a.parent){e.canvas.style.display="inline-block",b&&b.parentNode!=e.canvas&&(c=(b=e.canvas.firstChild)&&b.firstChild);if(!b){b=e.canvas.appendChild(this.create("svg")),b.setAttribute("font-size","10px"),b.setAttribute("font-family","sans-serif"),b.setAttribute("fill","none"),b.setAttribute("stroke","none"),b.setAttribute("stroke-width",1.5);for(var f=0;f<this.events.length;f++)b.addEventListener(this.events[f],this.dispatch,!1);c=b.firstChild}a.$g=b,b.setAttribute("width",e.width+e.left+e.right),b.setAttribute("height",e.height+e.top+e.bottom)}if(e.overflow=="hidden"){f=pv.id().toString(36);var g=this.expect(c,"g",{"clip-path":"url(#"+f+")"});g.parentNode||b.appendChild(g),a.$g=b=g,c=g.firstChild,c=this.expect(c,"clipPath",{id:f}),f=c.firstChild||c.appendChild(this.create("rect")),f.setAttribute("x",e.left),f.setAttribute("y",e.top),f.setAttribute("width",e.width),f.setAttribute("height",e.height),c.parentNode||b.appendChild(c),c=c.nextSibling}c=this.fill(c,a,d);var h=this.scale,i=e.transform,j=e.left+i.x,k=e.top+i.y;this.scale*=i.k;for(f=0;f<e.children.length;f++)e.children[f].$g=c=this.expect(c,"g",{transform:"translate("+j+","+k+")"+(i.k!=1?" scale("+i.k+")":"")}),this.updateAll(e.children[f]),c.parentNode||b.appendChild(c),c=c.nextSibling;this.scale=h,c=this.stroke(c,a,d),e.overflow=="hidden"&&(a.$g=b=g.parentNode,c=g.nextSibling)}}return c},pv.SvgScene.fill=function(a,b,c){var d=b[c],e=d.fillStyle;if(e.opacity||d.events=="all")a=this.expect(a,"rect",{"shape-rendering":d.antialias?null:"crispEdges","pointer-events":d.events,cursor:d.cursor,x:d.left,y:d.top,width:d.width,height:d.height,fill:e.color,"fill-opacity":e.opacity,stroke:null}),a=this.append(a,b,c);return a},pv.SvgScene.stroke=function(a,b,c){var d=b[c],e=d.strokeStyle;if(e.opacity||d.events=="all")a=this.expect(a,"rect",{"shape-rendering":d.antialias?null:"crispEdges","pointer-events":d.events=="all"?"stroke":d.events,cursor:d.cursor,x:d.left,y:d.top,width:Math.max(1e-10,d.width),height:Math.max(1e-10,d.height),fill:null,stroke:e.color,"stroke-opacity":e.opacity,"stroke-width":d.lineWidth/this.scale}),a=this.append(a,b,c);return a},pv.SvgScene.rule=function(a){for(var b=a.$g.firstChild,c=0;c<a.length;c++){var d=a[c];if(d.visible){var e=d.strokeStyle;e.opacity&&(b=this.expect(b,"line",{"shape-rendering":d.antialias?null:"crispEdges","pointer-events":d.events,cursor:d.cursor,x1:d.left,y1:d.top,x2:d.left+d.width,y2:d.top+d.height,stroke:e.color,"stroke-opacity":e.opacity,"stroke-width":d.lineWidth/this.scale}),b=this.append(b,a,c))}}return b},pv.SvgScene.wedge=function(a){for(var b=a.$g.firstChild,c=0;c<a.length;c++){var d=a[c];if(d.visible){var e=d.fillStyle,f=d.strokeStyle;if(e.opacity||f.opacity){var g=d.innerRadius,h=d.outerRadius,i=Math.abs(d.angle);if(i>=2*Math.PI)g=g?"M0,"+h+"A"+h+","+h+" 0 1,1 0,"+ -h+"A"+h+","+h+" 0 1,1 0,"+h+"M0,"+g+"A"+g+","+g+" 0 1,1 0,"+ -g+"A"+g+","+g+" 0 1,1 0,"+g+"Z":"M0,"+h+"A"+h+","+h+" 0 1,1 0,"+ -h+"A"+h+","+h+" 0 1,1 0,"+h+"Z";else{var j=Math.min(d.startAngle,d.endAngle),k=Math.max(d.startAngle,d.endAngle),l=Math.cos(j),m=Math.cos(k);j=Math.sin(j),k=Math.sin(k),g=g?"M"+h*l+","+h*j+"A"+h+","+h+" 0 "+(i<Math.PI?"0":"1")+",1 "+h*m+","+h*k+"L"+g*m+","+g*k+"A"+g+","+g+" 0 "+(i<Math.PI?"0":"1")+",0 "+g*l+","+g*j+"Z":"M"+h*l+","+h*j+"A"+h+","+h+" 0 "+(i<Math.PI?"0":"1")+",1 "+h*m+","+h*k+"L0,0Z"}b=this.expect(b,"path",{"shape-rendering":d.antialias?null:"crispEdges","pointer-events":d.events,cursor:d.cursor,transform:"translate("+d.left+","+d.top+")",d:g,fill:e.color,"fill-rule":"evenodd","fill-opacity":e.opacity||null,stroke:f.color,"stroke-opacity":f.opacity||null,"stroke-width":f.opacity?d.lineWidth/this.scale:null}),b=this.append(b,a,c)}}}return b},pv.Mark=function(){this.$properties=[],this.$handlers={}},pv.Mark.prototype.properties={},pv.Mark.cast={},pv.Mark.prototype.property=function(a,b){return this.hasOwnProperty("properties")||(this.properties=pv.extend(this.properties)),this.properties[a]=!0,pv.Mark.prototype.propertyMethod(a,!1,pv.Mark.cast[a]=b),this},pv.Mark.prototype.propertyMethod=function(a,b,c){c||(c=pv.Mark.cast[a]),this[a]=function(e){if(b&&this.scene){var f=this.scene.defs;return arguments.length?(f[a]={id:e==null?0:pv.id(),value:e!=null&&c?c(e):e},this):f[a]?f[a].value:null}return arguments.length?(f=!b<<1|typeof e=="function",this.propertyValue(a,f&1&&c?function(){var a=e.apply(this,arguments);return a!=null?c(a):null}:e!=null&&c?c(e):e).type=f,this):this.instance()[a]}},pv.Mark.prototype.propertyValue=function(a,b){var c=this.$properties;b={name:a,id:pv.id(),value:b};for(var d=0;d<c.length;d++)if(c[d].name==a){c.splice(d,1);break}return c.push(b),b},pv.Mark.prototype.property("data").property("visible",Boolean).property("left",Number).property("right",Number).property("top",Number).property("bottom",Number).property("cursor",String).property("title",String).property("reverse",Boolean).property("antialias",Boolean).property("events",String),a=pv.Mark.prototype,a.childIndex=-1,a.index=-1,a.scale=1,a.defaults=(new pv.Mark).data(function(a){return[a]}).visible(!0).antialias(!0).events("painted"),a.extend=function(a){return this.proto=a,this.target=a.target,this},a.add=function(a){return this.parent.add(a).extend(this)},a.def=function(a,b){return this.propertyMethod(a,!0),this[a](arguments.length>1?b:null)},a.anchor=function(a){return a||(a="center"),(new pv.Anchor(this)).name(a).data(function(){return this.scene.target.map(function(a){return a.data})}).visible(function(){return this.scene.target[this.index].visible}).left(function(){var a=this.scene.target[this.index],b=a.width||0;switch(this.name()){case"bottom":case"top":case"center":return a.left+b/2;case"left":return null}return a.left+b}).top(function(){var a=this.scene.target[this.index],b=a.height||0;switch(this.name()){case"left":case"right":case"center":return a.top+b/2;case"top":return null}return a.top+b}).right(function(){var a=this.scene.target[this.index];return this.name()=="left"?a.right+(a.width||0):null}).bottom(function(){var a=this.scene.target[this.index];return this.name()=="top"?a.bottom+(a.height||0):null}).textAlign(function(){switch(this.name()){case"bottom":case"top":case"center":return"center";case"right":return"right"}return"left"}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"top":return"top"}return"bottom"})},a.anchorTarget=function(){return this.target},a.margin=function(a){return this.left(a).right(a).top(a).bottom(a)},a.instance=function(a){var b=this.scene||this.parent.instance(-1).children[this.childIndex],c=!arguments.length||this.hasOwnProperty("index")?this.index:a;return b[c<0?b.length-1:c]},a.instances=function(a){for(var b=this,c=[],d;!(d=b.scene);)a=a.parent,c.push({index:a.index,childIndex:b.childIndex}),b=b.parent;for(;c.length;)a=c.pop(),d=d[a.index].children[a.childIndex];return this.hasOwnProperty("index")?(c=pv.extend(d[this.index]),c.right=c.top=c.left=c.bottom=0,[c]):d},a.first=function(){return this.scene[0]},a.last=function(){return this.scene[this.scene.length-1]},a.sibling=function(){return this.index==0?null:this.scene[this.index-1]},a.cousin=function(){var a=this.parent;return(a=a&&a.sibling())&&a.children?a.children[this.childIndex][this.index]:null},a.render=function(){function a(a,c,f){a.scale=f;if(c<e.length){d.unshift(null);if(a.hasOwnProperty("index"))b(a,c,f);else{for(var h=0,i=a.scene.length;h<i;h++)a.index=h,b(a,c,f);delete a.index}d.shift()}else a.build(),pv.Scene.scale=f,pv.Scene.updateAll(a.scene);delete a.scale}function b(b,c,f){var h=b.scene[b.index],i;if(h.visible){var j=e[c],k=b.children[j];for(i=0;i<j;i++)b.children[i].scene=h.children[i];d[0]=h.data,k.scene?a(k,c+1,f*h.transform.k):(k.scene=h.children[j],a(k,c+1,f*h.transform.k),delete k.scene);for(i=0;i<j;i++)delete b.children[i].scene}}var c=this.parent,d=pv.Mark.stack;if(c&&!this.root.scene)this.root.render();else{for(var e=[],f=this;f.parent;f=f.parent)e.unshift(f.childIndex);for(this.bind();c&&!c.hasOwnProperty("index");)c=c.parent;this.context(c?c.scene:undefined,c?c.index:-1,function(){a(this.root,0,1)})}},pv.Mark.stack=[],a=pv.Mark.prototype,a.bind=function(){function a(a){do for(var f=a.$properties,g=f.length-1;g>=0;g--){var h=f[g];if(!(h.name in b)){b[h.name]=h;switch(h.name){case"data":d=h;break;case"visible":e=h;break;default:c[h.type].push(h)}}}while(a=a.proto)}var b={},c=[[],[],[],[]],d,e;a(this),a(this.defaults),c[1].reverse(),c[3].reverse();var f=this;do for(var g in f.properties)g in b||c[2].push(b[g]={name:g,type:2,value:null});while(f=f.proto);f=c[0].concat(c[1]);for(g=0;g<f.length;g++)this.propertyMethod(f[g].name,!0);this.binds={properties:b,data:d,defs:f,required:[e],optional:pv.blend(c)}},a.build=function(){var a=this.scene,b=pv.Mark.stack;a||(a=this.scene=[],a.mark=this,a.type=this.type,a.childIndex=this.childIndex,this.parent&&(a.parent=this.parent.scene,a.parentIndex=this.parent.index)),this.target&&(a.target=this.target.instances(a));if(this.binds.defs.length){var c=a.defs;c||(a.defs=c={});for(var d=0;d<this.binds.defs.length;d++){var e=this.binds.defs[d],f=c[e.name];if(!f||e.id>f.id)c[e.name]={id:0,value:e.type&1?e.value.apply(this,b):e.value}}}c=this.binds.data,c=c.type&1?c.value.apply(this,b):c.value,b.unshift(null),a.length=c.length;for(d=0;d<c.length;d++)pv.Mark.prototype.index=this.index=d,(e=a[d])||(a[d]=e={}),e.data=b[0]=c[d],this.buildInstance(e);return pv.Mark.prototype.index=-1,delete this.index,b.shift(),this},a.buildProperties=function(a,b){for(var c=0,d=b.length;c<d;c++){var e=b[c],f=e.value;switch(e.type){case 0:case 1:f=this.scene.defs[e.name].value;break;case 3:f=f.apply(this,pv.Mark.stack)}a[e.name]=f}},a.buildInstance=function(a){this.buildProperties(a,this.binds.required),a.visible&&(this.buildProperties(a,this.binds.optional),this.buildImplied(a))},a.buildImplied=function(a){var b=a.left,c=a.right,d=a.top,e=a.bottom,f=this.properties,g=f.width?a.width:0,h=f.height?a.height:0,i=this.parent?this.parent.width():g+b+c;g==null?g=i-(c=c||0)-(b=b||0):c==null?b==null?b=c=(i-g)/2:c=i-g-(b=b||0):b==null&&(b=i-g-c),i=this.parent?this.parent.height():h+d+e,h==null?h=i-(d=d||0)-(e=e||0):e==null?e=d==null?d=(i-h)/2:i-h-(d=d||0):d==null&&(d=i-h-e),a.left=b,a.right=c,a.top=d,a.bottom=e,f.width&&(a.width=g),f.height&&(a.height=h),f.textStyle&&!a.textStyle&&(a.textStyle=pv.Color.transparent),f.fillStyle&&!a.fillStyle&&(a.fillStyle=pv.Color.transparent),f.strokeStyle&&!a.strokeStyle&&(a.strokeStyle=pv.Color.transparent)},a.mouse=function(){var a=pv.event.pageX||0,b=pv.event.pageY||0,c=this.root.canvas();do a-=c.offsetLeft,b-=c.offsetTop;while(c=c.offsetParent);c=pv.Transform.identity;var d=this.properties.transform?this:this.parent,e=[];do e.push(d);while(d=d.parent);for(;d=e.pop();)c=c.translate(d.left(),d.top()).times(d.transform());return c=c.invert(),pv.vector(a*c.k+c.x,b*c.k+c.y)},a.event=function(a,b){return this.$handlers[a]=pv.functor(b),this},a.context=function(a,b,c){function d(a,b){pv.Mark.scene=a,f.index=b;if(a){var c=a.mark,d=c,e=[];do e.push(d),g.push(a[b].data),d.index=b,d.scene=a,b=a.parentIndex,a=a.parent;while(d=d.parent);a=e.length-1;for(b=1;a>0;a--)d=e[a],d.scale=b,b*=d.scene[d.index].transform.k;if(c.children){a=0;for(e=c.children.length;a<e;a++)d=c.children[a],d.scene=c.scene[c.index].children[a],d.scale=b}}}function e(a){if(a){a=a.mark;var b;if(a.children)for(var c=0,d=a.children.length;c<d;c++)b=a.children[c],delete b.scene,delete b.scale;b=a;do g.pop(),b.parent&&(delete b.scene,delete b.scale),delete b.index;while(b=b.parent)}}var f=pv.Mark.prototype,g=pv.Mark.stack,h=pv.Mark.scene,i=f.index;e(h,i),d(a,b);try{c.apply(this,g)}finally{e(a,b),d(h,i)}},pv.Mark.dispatch=function(a,b,c){var d=b.mark,e=b.parent,f=d.$handlers[a];return f?(d.context(b,c,function(){(d=f.apply(d,pv.Mark.stack))&&d.render&&d.render()}),!0):e&&pv.Mark.dispatch(a,e,b.parentIndex)},pv.Anchor=function(a){pv.Mark.call(this),this.target=a,this.parent=a.parent},pv.Anchor.prototype=pv.extend(pv.Mark).property("name",String),pv.Anchor.prototype.extend=function(a){return this.proto=a,this},pv.Area=function(){pv.Mark.call(this)},pv.Area.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color).property("segmented",Boolean).property("interpolate",String).property("tension",Number),pv.Area.prototype.type="area",pv.Area.prototype.defaults=(new pv.Area).extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent)).interpolate("linear").tension(.7),pv.Area.prototype.buildImplied=function(a){a.height==null&&(a.height=0),a.width==null&&(a.width=0),pv.Mark.prototype.buildImplied.call(this,a)},pv.Area.fixed={lineWidth:1,lineJoin:1,strokeStyle:1,fillStyle:1,segmented:1,interpolate:1,tension:1},pv.Area.prototype.bind=function(){pv.Mark.prototype.bind.call(this);var a=this.binds,b=a.required;a=a.optional;for(var c=0,d=a.length;c<d;c++){var e=a[c];e.fixed=e.name in pv.Area.fixed,e.name=="segmented"&&(b.push(e),a.splice(c,1),c--,d--)}this.binds.$required=b,this.binds.$optional=a},pv.Area.prototype.buildInstance=function(a){var b=this.binds;if(this.index){var c=b.fixed;if(!c){c=b.fixed=[];function d(a){return!a.fixed||(c.push(a),!1)}b.required=b.required.filter(d),this.scene[0].segmented||(b.optional=b.optional.filter(d))}b=0;for(var e=c.length;b<e;b++){var f=c[b].name;a[f]=this.scene[0][f]}}else b.required=b.$required,b.optional=b.$optional,b.fixed=null;pv.Mark.prototype.buildInstance.call(this,a)},pv.Area.prototype.anchor=function(a){return pv.Mark.prototype.anchor.call(this,a).interpolate(function(){return this.scene.target[this.index].interpolate}).eccentricity(function(){return this.scene.target[this.index].eccentricity}).tension(function(){return this.scene.target[this.index].tension})},pv.Bar=function(){pv.Mark.call(this)},pv.Bar.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color),pv.Bar.prototype.type="bar",pv.Bar.prototype.defaults=(new pv.Bar).extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent)),pv.Dot=function(){pv.Mark.call(this)},pv.Dot.prototype=pv.extend(pv.Mark).property("size",Number).property("radius",Number).property("shape",String).property("angle",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color),pv.Dot.prototype.type="dot",pv.Dot.prototype.defaults=(new pv.Dot).extend(pv.Mark.prototype.defaults).size(20).shape("circle").lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent)),pv.Dot.prototype.anchor=function(a){return pv.Mark.prototype.anchor.call(this,a).left(function(){var a=this.scene.target[this.index];switch(this.name()){case"bottom":case"top":case"center":return a.left;case"left":return null}return a.left+a.radius}).right(function(){var a=this.scene.target[this.index];return this.name()=="left"?a.right+a.radius:null}).top(function(){var a=this.scene.target[this.index];switch(this.name()){case"left":case"right":case"center":return a.top;case"top":return null}return a.top+a.radius}).bottom(function(){var a=this.scene.target[this.index];return this.name()=="top"?a.bottom+a.radius:null}).textAlign(function(){switch(this.name()){case"left":return"right";case"bottom":case"top":case"center":return"center"}return"left"}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"bottom":return"top"}return"bottom"})},pv.Dot.prototype.buildImplied=function(a){a.radius==null?a.radius=Math.sqrt(a.size):a.size==null&&(a.size=a.radius*a.radius),pv.Mark.prototype.buildImplied.call(this,a)},pv.Label=function(){pv.Mark.call(this)},pv.Label.prototype=pv.extend(pv.Mark).property("text",String).property("font",String).property("textAngle",Number).property("textStyle",pv.color).property("textAlign",String).property("textBaseline",String).property("textMargin",Number).property("textDecoration",String).property("textShadow",String),pv.Label.prototype.type="label",pv.Label.prototype.defaults=(new pv.Label).extend(pv.Mark.prototype.defaults).events("none").text(pv.identity).font("10px sans-serif").textAngle(0).textStyle("black").textAlign("left").textBaseline("bottom").textMargin(3),pv.Line=function(){pv.Mark.call(this)},pv.Line.prototype=pv.extend(pv.Mark).property("lineWidth",Number).property("lineJoin",String).property("strokeStyle",pv.color).property("fillStyle",pv.color).property("segmented",Boolean).property("interpolate",String).property("eccentricity",Number).property("tension",Number),a=pv.Line.prototype,a.type="line",a.defaults=(new pv.Line).extend(pv.Mark.prototype.defaults).lineJoin("miter").lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent)).interpolate("linear").eccentricity(0).tension(.7),a.bind=pv.Area.prototype.bind,a.buildInstance=pv.Area.prototype.buildInstance,a.anchor=function(a){return pv.Area.prototype.anchor.call(this,a).textAlign(function(){switch(this.name()){case"left":return"right";case"bottom":case"top":case"center":return"center";case"right":return"left"}}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"top":return"bottom";case"bottom":return"top"}})},pv.Rule=function(){pv.Mark.call(this)},pv.Rule.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.color),pv.Rule.prototype.type="rule",pv.Rule.prototype.defaults=(new pv.Rule).extend(pv.Mark.prototype.defaults).lineWidth(1).strokeStyle("black").antialias(!1),pv.Rule.prototype.anchor=pv.Line.prototype.anchor
,pv.Rule.prototype.buildImplied=function(a){var b=a.left,c=a.right;a.width!=null||b==null&&c==null||c!=null&&b!=null?a.height=0:a.width=0,pv.Mark.prototype.buildImplied.call(this,a)},pv.Panel=function(){pv.Bar.call(this),this.children=[],this.root=this,this.$dom=pv.$&&pv.$.s},pv.Panel.prototype=pv.extend(pv.Bar).property("transform").property("overflow",String).property("canvas",function(a){return typeof a=="string"?document.getElementById(a):a}),a=pv.Panel.prototype,a.type="panel",a.defaults=(new pv.Panel).extend(pv.Bar.prototype.defaults).fillStyle(null).overflow("visible"),a.anchor=function(a){return a=pv.Bar.prototype.anchor.call(this,a),a.parent=this,a},a.add=function(a){return a=new a,a.parent=this,a.root=this.root,a.childIndex=this.children.length,this.children.push(a),a},a.bind=function(){pv.Mark.prototype.bind.call(this);for(var a=0;a<this.children.length;a++)this.children[a].bind()},a.buildInstance=function(a){pv.Bar.prototype.buildInstance.call(this,a);if(a.visible){a.children||(a.children=[]);var b=this.scale*a.transform.k,c,d=this.children.length;pv.Mark.prototype.index=-1;for(var e=0;e<d;e++)c=this.children[e],c.scene=a.children[e],c.scale=b,c.build();for(e=0;e<d;e++)c=this.children[e],a.children[e]=c.scene,delete c.scene,delete c.scale;a.children.length=d}},a.buildImplied=function(a){if(!this.parent){var b=a.canvas;if(b){if(b.$panel!=this)for(b.$panel=this;b.lastChild;)b.removeChild(b.lastChild);var c;a.width==null&&(c=parseFloat(pv.css(b,"width")),a.width=c-a.left-a.right),a.height==null&&(c=parseFloat(pv.css(b,"height")),a.height=c-a.top-a.bottom)}else{c=this.$canvas||(this.$canvas=[]);if(!(b=c[this.index])){b=c[this.index]=document.createElement("span");if(this.$dom)this.$dom.parentNode.insertBefore(b,this.$dom);else{for(c=document.body;c.lastChild&&c.lastChild.tagName;)c=c.lastChild;c!=document.body&&(c=c.parentNode),c.appendChild(b)}}}a.canvas=b}a.transform||(a.transform=pv.Transform.identity),pv.Mark.prototype.buildImplied.call(this,a)},pv.Image=function(){pv.Bar.call(this)},pv.Image.prototype=pv.extend(pv.Bar).property("url",String).property("imageWidth",Number).property("imageHeight",Number),a=pv.Image.prototype,a.type="image",a.defaults=(new pv.Image).extend(pv.Bar.prototype.defaults).fillStyle(null),a.image=function(a){return this.$image=function(){var c=a.apply(this,arguments);return c==null?pv.Color.transparent:typeof c=="string"?pv.color(c):c},this},a.bind=function(){pv.Bar.prototype.bind.call(this);var a=this.binds,b=this;do a.image=b.$image;while(!a.image&&(b=b.proto))},a.buildImplied=function(a){pv.Bar.prototype.buildImplied.call(this,a);if(a.visible){a.imageWidth==null&&(a.imageWidth=a.width),a.imageHeight==null&&(a.imageHeight=a.height);if(a.url==null&&this.binds.image){var b=this.$canvas||(this.$canvas=document.createElement("canvas")),c=b.getContext("2d"),d=a.imageWidth,e=a.imageHeight,f=pv.Mark.stack;b.width=d,b.height=e,a=(a.image=c.createImageData(d,e)).data,f.unshift(null,null);for(c=b=0;b<e;b++){f[1]=b;for(var g=0;g<d;g++){f[0]=g;var h=this.binds.image.apply(this,f);a[c++]=h.r,a[c++]=h.g,a[c++]=h.b,a[c++]=255*h.a}}f.splice(0,2)}}},pv.Wedge=function(){pv.Mark.call(this)},pv.Wedge.prototype=pv.extend(pv.Mark).property("startAngle",Number).property("endAngle",Number).property("angle",Number).property("innerRadius",Number).property("outerRadius",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color),a=pv.Wedge.prototype,a.type="wedge",a.defaults=(new pv.Wedge).extend(pv.Mark.prototype.defaults).startAngle(function(){var a=this.sibling();return a?a.endAngle:-Math.PI/2}).innerRadius(0).lineWidth(1.5).strokeStyle(null).fillStyle(pv.Colors.category20().by(pv.index)),a.midRadius=function(){return(this.innerRadius()+this.outerRadius())/2},a.midAngle=function(){return(this.startAngle()+this.endAngle())/2},a.anchor=function(a){function b(a){return a.innerRadius||a.angle<2*Math.PI}function c(a){return(a.innerRadius+a.outerRadius)/2}function d(a){return(a.startAngle+a.endAngle)/2}return pv.Mark.prototype.anchor.call(this,a).left(function(){var a=this.scene.target[this.index];if(b(a))switch(this.name()){case"outer":return a.left+a.outerRadius*Math.cos(d(a));case"inner":return a.left+a.innerRadius*Math.cos(d(a));case"start":return a.left+c(a)*Math.cos(a.startAngle);case"center":return a.left+c(a)*Math.cos(d(a));case"end":return a.left+c(a)*Math.cos(a.endAngle)}return a.left}).top(function(){var a=this.scene.target[this.index];if(b(a))switch(this.name()){case"outer":return a.top+a.outerRadius*Math.sin(d(a));case"inner":return a.top+a.innerRadius*Math.sin(d(a));case"start":return a.top+c(a)*Math.sin(a.startAngle);case"center":return a.top+c(a)*Math.sin(d(a));case"end":return a.top+c(a)*Math.sin(a.endAngle)}return a.top}).textAlign(function(){var a=this.scene.target[this.index];if(b(a))switch(this.name()){case"outer":return pv.Wedge.upright(d(a))?"right":"left";case"inner":return pv.Wedge.upright(d(a))?"left":"right"}return"center"}).textBaseline(function(){var a=this.scene.target[this.index];if(b(a))switch(this.name()){case"start":return pv.Wedge.upright(a.startAngle)?"top":"bottom";case"end":return pv.Wedge.upright(a.endAngle)?"bottom":"top"}return"middle"}).textAngle(function(){var a=this.scene.target[this.index],c=0;if(b(a))switch(this.name()){case"center":case"inner":case"outer":c=d(a);break;case"start":c=a.startAngle;break;case"end":c=a.endAngle}return pv.Wedge.upright(c)?c:c+Math.PI})},pv.Wedge.upright=function(a){return a%=2*Math.PI,a=a<0?2*Math.PI+a:a,a<Math.PI/2||a>=3*Math.PI/2},pv.Wedge.prototype.buildImplied=function(a){a.angle==null?a.angle=a.endAngle-a.startAngle:a.endAngle==null&&(a.endAngle=a.startAngle+a.angle),pv.Mark.prototype.buildImplied.call(this,a)},pv.simulation=function(a){return new pv.Simulation(a)},pv.Simulation=function(a){for(var b=0;b<a.length;b++)this.particle(a[b])},a=pv.Simulation.prototype,a.particle=function(a){return a.next=this.particles,isNaN(a.px)&&(a.px=a.x),isNaN(a.py)&&(a.py=a.y),isNaN(a.fx)&&(a.fx=0),isNaN(a.fy)&&(a.fy=0),this.particles=a,this},a.force=function(a){return a.next=this.forces,this.forces=a,this},a.constraint=function(a){return a.next=this.constraints,this.constraints=a,this},a.stabilize=function(a){var b;arguments.length||(a=3);for(var c=0;c<a;c++){var d=new pv.Quadtree(this.particles);for(b=this.constraints;b;b=b.next)b.apply(this.particles,d)}for(b=this.particles;b;b=b.next)b.px=b.x,b.py=b.y;return this},a.step=function(){var a;for(a=this.particles;a;a=a.next){var b=a.px,c=a.py;a.px=a.x,a.py=a.y,a.x+=a.vx=a.x-b+a.fx,a.y+=a.vy=a.y-c+a.fy}b=new pv.Quadtree(this.particles);for(a=this.constraints;a;a=a.next)a.apply(this.particles,b);for(a=this.particles;a;a=a.next)a.fx=a.fy=0;for(a=this.forces;a;a=a.next)a.apply(this.particles,b)},pv.Quadtree=function(a){function b(a,b,d,e,f,g){if(!isNaN(b.x)&&!isNaN(b.y))if(a.leaf)if(a.p){if(!(Math.abs(a.p.x-b.x)+Math.abs(a.p.y-b.y)<.01)){var h=a.p;a.p=null,c(a,h,d,e,f,g)}c(a,b,d,e,f,g)}else a.p=b;else c(a,b,d,e,f,g)}function c(a,c,d,e,f,g){var h=(d+f)*.5,i=(e+g)*.5,j=c.x>=h,k=c.y>=i;a.leaf=!1;switch((k<<1)+j){case 0:a=a.c1||(a.c1=new pv.Quadtree.Node);break;case 1:a=a.c2||(a.c2=new pv.Quadtree.Node);break;case 2:a=a.c3||(a.c3=new pv.Quadtree.Node);break;case 3:a=a.c4||(a.c4=new pv.Quadtree.Node)}j?d=h:f=h,k?e=i:g=i,b(a,c,d,e,f,g)}var d,e=Number.POSITIVE_INFINITY,f=e,g=Number.NEGATIVE_INFINITY,h=g;for(d=a;d;d=d.next)d.x<e&&(e=d.x),d.y<f&&(f=d.y),d.x>g&&(g=d.x),d.y>h&&(h=d.y);d=g-e;var i=h-f;d>i?h=f+d:g=e+i,this.xMin=e,this.yMin=f,this.xMax=g,this.yMax=h,this.root=new pv.Quadtree.Node;for(d=a;d;d=d.next)b(this.root,d,e,f,g,h)},pv.Quadtree.Node=function(){this.leaf=!0,this.p=this.c4=this.c3=this.c2=this.c1=null},pv.Force={},pv.Force.charge=function(a){function b(c){function d(a){b(a),c.cn+=a.cn,e+=a.cn*a.cx,f+=a.cn*a.cy}var e=0,f=0;c.cn=0,c.leaf||(c.c1&&d(c.c1),c.c2&&d(c.c2),c.c3&&d(c.c3),c.c4&&d(c.c4)),c.p&&(c.cn+=a,e+=a*c.p.x,f+=a*c.p.y),c.cx=e/c.cn,c.cy=f/c.cn}function c(b,d,f,i,k,l){var m=b.cx-d.x,n=b.cy-d.y,o=1/Math.sqrt(m*m+n*n);if(b.leaf&&b.p!=d||(k-f)*o<h)o<g||(o>e&&(o=e),b=b.cn*o*o*o,m*=b,n*=b,d.fx+=m,d.fy+=n);else if(!b.leaf){var p=(f+k)*.5,q=(i+l)*.5;b.c1&&c(b.c1,d,f,i,p,q),b.c2&&c(b.c2,d,p,i,k,q),b.c3&&c(b.c3,d,f,q,p,l),b.c4&&c(b.c4,d,p,q,k,l),o<g||(o>e&&(o=e),b.p&&b.p!=d&&(b=a*o*o*o,m*=b,n*=b,d.fx+=m,d.fy+=n))}}var d=2,e=1/d,f=500,g=1/f,h=.9,i={};return arguments.length||(a=-40),i.constant=function(b){return arguments.length?(a=Number(b),i):a},i.domain=function(a,b){return arguments.length?(d=Number(a),e=1/d,f=Number(b),g=1/f,i):[d,f]},i.theta=function(a){return arguments.length?(h=Number(a),i):h},i.apply=function(a,d){b(d.root);for(a=a;a;a=a.next)c(d.root,a,d.xMin,d.yMin,d.xMax,d.yMax)},i},pv.Force.drag=function(a){var b={};return arguments.length||(a=.1),b.constant=function(d){return arguments.length?(a=d,b):a},b.apply=function(b){if(a)for(b=b;b;b=b.next)b.fx-=a*b.vx,b.fy-=a*b.vy},b},pv.Force.spring=function(a){var b=.1,c=20,d,e,f={};return arguments.length||(a=.1),f.links=function(a){return arguments.length?(d=a,e=a.map(function(a){return 1/Math.sqrt(Math.max(a.sourceNode.linkDegree,a.targetNode.linkDegree))}),f):d},f.constant=function(b){return arguments.length?(a=Number(b),f):a},f.damping=function(a){return arguments.length?(b=Number(a),f):b},f.length=function(a){return arguments.length?(c=Number(a),f):c},f.apply=function(){for(var f=0;f<d.length;f++){var h=d[f].sourceNode,i=d[f].targetNode,j=h.x-i.x,k=h.y-i.y,l=Math.sqrt(j*j+k*k),m=l?1/l:1;m=(a*e[f]*(l-c)+b*e[f]*(j*(h.vx-i.vx)+k*(h.vy-i.vy))*m)*m,j=-m*(l?j:.01*(.5-Math.random())),k=-m*(l?k:.01*(.5-Math.random())),h.fx+=j,h.fy+=k,i.fx-=j,i.fy-=k}},f},pv.Constraint={},pv.Constraint.collision=function(a){function b(c,i,k,l,m,n){if(!c.leaf){var o=(k+m)*.5,p=(l+n)*.5,q=p<h,r=o>e,s=o<g;p>f&&(c.c1&&r&&b(c.c1,i,k,l,o,p),c.c2&&s&&b(c.c2,i,o,l,m,p)),q&&(c.c3&&r&&b(c.c3,i,k,p,o,n),c.c4&&s&&b(c.c4,i,o,p,m,n))}c.p&&c.p!=i&&(k=i.x-c.p.x,l=i.y-c.p.y,m=Math.sqrt(k*k+l*l),n=d+a(c.p),m<n&&(m=(m-n)/m*.5,k*=m,l*=m,i.x-=k,i.y-=l,c.p.x+=k,c.p.y+=l))}var c=1,d,e,f,g,h,i={};return arguments.length||(d=10),i.repeat=function(a){return arguments.length?(c=Number(a),i):c},i.apply=function(i,k){var l,m,n=-Infinity;for(l=i;l;l=l.next)m=a(l),m>n&&(n=m);for(var o=0;o<c;o++)for(l=i;l;l=l.next)m=(d=a(l))+n,e=l.x-m,g=l.x+m,f=l.y-m,h=l.y+m,b(k.root,l,k.xMin,k.yMin,k.xMax,k.yMax)},i},pv.Constraint.position=function(a){var b=1,c={};return arguments.length||(a=function(a){return a.fix}),c.alpha=function(a){return arguments.length?(b=Number(a),c):b},c.apply=function(c){for(c=c;c;c=c.next){var d=a(c);d&&(c.x+=(d.x-c.x)*b,c.y+=(d.y-c.y)*b,c.fx=c.fy=c.vx=c.vy=0)}},c},pv.Constraint.bound=function(){var a={},b,c;return a.x=function(a,c){return arguments.length?(b={min:Math.min(a,c),max:Math.max(a,c)},this):b},a.y=function(a,b){return arguments.length?(c={min:Math.min(a,b),max:Math.max(a,b)},this):c},a.apply=function(a){if(b)for(var e=a;e;e=e.next)e.x=e.x<b.min?b.min:e.x>b.max?b.max:e.x;if(c)for(e=a;e;e=e.next)e.y=e.y<c.min?c.min:e.y>c.max?c.max:e.y},a},pv.Layout=function(){pv.Panel.call(this)},pv.Layout.prototype=pv.extend(pv.Panel),pv.Layout.prototype.property=function(a,b){return this.hasOwnProperty("properties")||(this.properties=pv.extend(this.properties)),this.properties[a]=!0,this.propertyMethod(a,!1,pv.Mark.cast[a]=b),this},pv.Layout.Network=function(){pv.Layout.call(this);var a=this;this.$id=pv.id(),(this.node=(new pv.Mark).data(function(){return a.nodes()}).strokeStyle("#1f77b4").fillStyle("#fff").left(function(a){return a.x}).top(function(a){return a.y})).parent=this,this.link=(new pv.Mark).extend(this.node).data(function(a){return[a.sourceNode,a.targetNode]}).fillStyle(null).lineWidth(function(a,b){return b.linkValue*1.5}).strokeStyle("rgba(0,0,0,.2)"),this.link.add=function(c){return a.add(pv.Panel).data(function(){return a.links()}).add(c).extend(this)},(this.label=(new pv.Mark).extend(this.node).textMargin(7).textBaseline("middle").text(function(a){return a.nodeName||a.nodeValue}).textAngle(function(a){return a=a.midAngle,pv.Wedge.upright(a)?a:a+Math.PI}).textAlign(function(a){return pv.Wedge.upright(a.midAngle)?"left":"right"})).parent=this},pv.Layout.Network.prototype=pv.extend(pv.Layout).property("nodes",function(a){return a.map(function(a,b){return typeof a!="object"&&(a={nodeValue:a}),a.index=b,a})}).property("links",function(a){return a.map(function(a){return isNaN(a.linkValue)&&(a.linkValue=isNaN(a.value)?1:a.value),a})}),pv.Layout.Network.prototype.reset=function(){return this.$id=pv.id(),this},pv.Layout.Network.prototype.buildProperties=function(a,b){(a.$id||0)<this.$id&&pv.Layout.prototype.buildProperties.call(this,a,b)},pv.Layout.Network.prototype.buildImplied=function(a){pv.Layout.prototype.buildImplied.call(this,a);if(a.$id>=this.$id)return!0;a.$id=this.$id,a.nodes.forEach(function(a){a.linkDegree=0}),a.links.forEach(function(c){var d=c.linkValue;(c.sourceNode||(c.sourceNode=a.nodes[c.source])).linkDegree+=d,(c.targetNode||(c.targetNode=a.nodes[c.target])).linkDegree+=d})},pv.Layout.Hierarchy=function(){pv.Layout.Network.call(this),this.link.strokeStyle("#ccc")},pv.Layout.Hierarchy.prototype=pv.extend(pv.Layout.Network),pv.Layout.Hierarchy.prototype.buildImplied=function(a){a.links||(a.links=pv.Layout.Hierarchy.links.call(this)),pv.Layout.Network.prototype.buildImplied.call(this,a)},pv.Layout.Hierarchy.links=function(){return this.nodes().filter(function(a){return a.parentNode}).map(function(a){return{sourceNode:a,targetNode:a.parentNode,linkValue:1}})},pv.Layout.Hierarchy.NodeLink={buildImplied:function(a){function b(a){return a.parentNode?a.depth*(l-k)+k:0}function c(a){return a.parentNode?(a.breadth-.25)*2*Math.PI:0}function d(a){switch(g){case"left":return a.depth*i;case"right":return i-a.depth*i;case"top":return a.breadth*i;case"bottom":return i-a.breadth*i;case"radial":return i/2+b(a)*Math.cos(a.midAngle)}}function e(a){switch(g){case"left":return a.breadth*j;case"right":return j-a.breadth*j;case"top":return a.depth*j;case"bottom":return j-a.depth*j;case"radial":return j/2+b(a)*Math.sin(a.midAngle)}}var f=a.nodes,g=a.orient,h=/^(top|bottom)$/.test(g),i=a.width,j=a.height;if(g=="radial"){var k=a.innerRadius,l=a.outerRadius;k==null&&(k=0),l==null&&(l=Math.min(i,j)/2)}for(a=0;a<f.length;a++){var m=f[a];m.midAngle=g=="radial"?c(m):h?Math.PI/2:0,m.x=d(m),m.y=e(m),m.firstChild&&(m.midAngle+=Math.PI)}}},pv.Layout.Hierarchy.Fill={constructor:function(){this.node.strokeStyle("#fff").fillStyle("#ccc").width(function(a){return a.dx}).height(function(a){return a.dy}).innerRadius(function(a){return a.innerRadius}).outerRadius(function(a){return a.outerRadius}).startAngle(function(a){return a.startAngle}).angle(function(a){return a.angle}),this.label.textAlign("center").left(function(a){return a.x+a.dx/2}).top(function(a){return a.y+a.dy/2}),delete this.link},buildImplied:function(a){function b(a,b){return(a+b)/(1+b)}function c(a){switch(l){case"left":return b(a.minDepth,p)*n;case"right":return(1-b(a.maxDepth,p))*n;case"top":return a.minBreadth*n;case"bottom":return(1-a.maxBreadth)*n;case"radial":return n/2}}function d(a){switch(l){case"left":return a.minBreadth*o;case"right":return(1-a.maxBreadth)*o;case"top":return b(a.minDepth,p)*o;case"bottom":return(1-b(a.maxDepth,p))*o;case"radial":return o/2}}function e(a){switch(l){case"left":case"right":return(a.maxDepth-a.minDepth)/(1+p)*n;case"top":case"bottom":return(a.maxBreadth-a.minBreadth)*n;case"radial":return a.parentNode?(a.innerRadius+a.outerRadius)*Math.cos(a.midAngle):0}}function f(a){switch(l){case"left":case"right":return(a.maxBreadth-a.minBreadth)*o;case"top":case"bottom":return(a.maxDepth-a.minDepth)/(1+p)*o;case"radial":return a.parentNode?(a.innerRadius+a.outerRadius)*Math.sin(a.midAngle):0}}function g(a){return Math.max(0,b(a.minDepth,p/2))*(r-q)+q}function h(a){return b(a.maxDepth,p/2)*(r-q)+q}function i(a){return(a.parentNode?a.minBreadth-.25:0)*2*Math.PI}function j(a){return(a.parentNode?a.maxBreadth-a.minBreadth:1)*2*Math.PI}var k=a.nodes,l=a.orient,m=/^(top|bottom)$/.test(l),n=a.width,o=a.height,p=-k[0].minDepth;if(l=="radial"){var q=a.innerRadius,r=a.outerRadius;q==null&&(q=0),q&&(p*=2),r==null&&(r=Math.min(n,o)/2)}for(a=0;a<k.length;a++){var s=k[a];s.x=c(s),s.y=d(s),l=="radial"?(s.innerRadius=g(s),s.outerRadius=h(s),s.startAngle=i(s),s.angle=j(s),s.midAngle=s.startAngle+s.angle/2):s.midAngle=m?-Math.PI/2:0,s.dx=e(s),s.dy=f(s)}}},pv.Layout.Grid=function(){pv.Layout.call(this);var a=this;(this.cell=(new pv.Mark).data(function(){return a.scene[a.index].$grid}).width(function(){return a.width()/a.cols()}).height(function(){return a.height()/a.rows()}).left(function(){return this.width()*(this.index%a.cols())}).top(function(){return this.height()*Math.floor(this.index/a.cols())})).parent=this},pv.Layout.Grid.prototype=pv.extend(pv.Layout).property("rows").property("cols"),pv.Layout.Grid.prototype.defaults=(new pv.Layout.Grid).extend(pv.Layout.prototype.defaults).rows(1).cols(1),pv.Layout.Grid.prototype.buildImplied=function(a){pv.Layout.prototype.buildImplied.call(this,a);var b=a.rows,c=a.cols;typeof c=="object"&&(b=pv.transpose(c)),typeof b=="object"?(a.$grid=pv.blend(b),a.rows=b.length,a.cols=b[0]?b[0].length:0):a.$grid=pv.repeat([a.data],b*c)},pv.Layout.Stack=function(){function a(a){return function(){return d[a](this.parent.index,this.index)}}pv.Layout.call(this);var b=this,c=function(){return null},d={t:c,l:c,r:c,b:c,w:c,h:c},e,f=b.buildImplied;this.buildImplied=function(a){f.call(this,a);var b=a.layers,i=b.length,j,k=a.orient,l=/^(top|bottom)\b/.test(k),m=this.parent[l?"height":"width"](),n=[],o=[],p=[],q=pv.Mark.stack,r={parent:{parent:this}};q.unshift(null),e=[];for(var s=0;s<i;s++){p[s]=[],o[s]=[],r.parent.index=s,q[0]=b[s],e[s]=this.$values.apply(r.parent,q),s||(j=e[s].length),q.unshift(null);for(var t=0;t<j;t++)q[0]=e[s][t],r.index=t,s||(n[t]=this.$x.apply(r,q)),p[s][t]=this.$y.apply(r,q);q.shift()}q.shift();switch(a.order){case"inside-out":var u=p.map(function(a){return pv.max.index(a)});r=pv.range(i).sort(function(a,b){return u[a]-u[b]}),b=p.map(function(a){return pv.sum(a)});var v=q=0,w=[],x=[];for(s=0;s<i;s++)t=r[s],q<v?(q+=b[t],w.push(t)):(v+=b[t],x.push(t));b=x.reverse().concat(w);break;case"reverse":b=pv.range(i-1,-1,-1);break;default:b=pv.range(i)}switch(a.offset){case"silohouette":for(t=0;t<j;t++){for(s=r=0;s<i;s++)r+=p[s][t];o[b[0]][t]=(m-r)/2}break;case"wiggle":for(s=r=0;s<i;s++)r+=p[s][0];o[b[0]][0]=r=(m-r)/2;for(t=1;t<j;t++){q=m=0,v=n[t]-n[t-1];for(s=0;s<i;s++)m+=p[s][t];for(s=0;s<i;s++){w=(p[b[s]][t]-p[b[s]][t-1])/(2*v);for(a=0;a<s;a++)w+=(p[b[a]][t]-p[b[a]][t-1])/v;q+=w*p[b[s]][t]}o[b[0]][t]=r-=m?q/m*v:0}break;case"expand":for(t=0;t<j;t++){for(s=a=o[b[0]][t]=0;s<i;s++)a+=p[s][t];if(a){a=m/a;for(s=0;s<i;s++)p[s][t]*=a}else{a=m/i;for(s=0;s<i;s++)p[s][t]=a}}break;default:for(t=0;t<j;t++)o[b[0]][t]=0}for(t=0;t<j;t++){r=o[b[0]][t];for(s=1;s<i;s++)r+=p[b[s-1]][t],o[b[s]][t]=r}s=k.indexOf("-"),i=l?"h":"w",l=s<0?l?"l":"b":k.charAt(s+1),k=k.charAt(0);for(var y in d)d[y]=c;d[l]=function(a,b){return n[b]},d[k]=function(a,b){return o[a][b]},d[i]=function(a,b){return p[a][b]}},this.layer=(new pv.Mark).data(function(){return e[this.parent.index]}).top(a("t")).left(a("l")).right(a("r")).bottom(a("b")).width(a("w")).height(a("h")),this.layer.add=function(a){return b.add(pv.Panel).data(function(){return b.layers()}).add(a).extend(this)}},pv.Layout.Stack.prototype=pv.extend(pv.Layout).property("orient",String).property("offset",String).property("order",String).property("layers"),a=pv.Layout.Stack.prototype,a.defaults=(new pv.Layout.Stack).extend(pv.Layout.prototype.defaults).orient("bottom-left").offset("zero").layers([[]]),a.$x=pv.Layout.Stack.prototype.$y=function(){return 0},a.x=function(a){return this.$x=pv.functor(a),this},a.y=function(a){return this.$y=pv.functor(a),this},a.$values=pv.identity,a.values=function(a){return this.$values=pv.functor(a),this},pv.Layout.Treemap=function(){pv.Layout.Hierarchy.call(this),this.node.strokeStyle("#fff").fillStyle("rgba(31, 119, 180, .25)").width(function(a){return a.dx}).height(function(a){return a.dy}),this.label.visible(function(a){return!a.firstChild}).left(function(a){return a.x+a.dx/2}).top(function(a){return a.y+a.dy/2}).textAlign("center").textAngle(function(a){return a.dx>a.dy?0:-Math.PI/2}),(this.leaf=(new pv.Mark).extend(this.node).fillStyle(null).strokeStyle(null).visible(function(a){return!a.firstChild})).parent=this,delete this.link},pv.Layout.Treemap.prototype=pv.extend(pv.Layout.Hierarchy).property("round",Boolean).property("paddingLeft",Number).property("paddingRight",Number).property("paddingTop",Number).property("paddingBottom",Number).property("mode",String).property("order",String),a=pv.Layout.Treemap.prototype,a.defaults=(new pv.Layout.Treemap).extend(pv.Layout.Hierarchy.prototype.defaults).mode("squarify").order("ascending"),a.padding=function(a){return this.paddingLeft(a).paddingRight(a).paddingTop(a).paddingBottom(a)},a.$size=function(a){return Number(a.nodeValue)},a.size=function(a){return this.$size=pv.functor(a),this},a.buildImplied=function(a){function b(a,b,c,d,e,f,g){for(var h=0,i=0;h<a.length;h++){var j=a[h];c?(j.x=d+i,j.y=e,i+=j.dx=m(f*j.size/b),j.dy=g):(j.x=d,j.y=e+i,j.dx=f,i+=j.dy=m(g*j.size/b))}j&&(c?j.dx+=f-i:j.dy+=g-i)}function c(a,b){for(var c=-Infinity,d=Infinity,e=0,f=0;f<a.length;f++){var g=a[f].size;g<d&&(d=g),g>c&&(c=g),e+=g}return e*=e,b*=b,Math.max(b*c/e,e/(b*d))}function d(a,d){function e(a){var c=o==t,d=pv.sum(a,l),e=t?m(d/t):0;return b(a,d,c,f,g,c?o:e,c?e:r),c?(g+=e,r-=e):(f+=e,o-=e),t=Math.min(o,r),c}var f=a.x+h,g=a.y+j,o=a.dx-h-i,r=a.dy-j-k;if(n!="squarify")b(a.childNodes,a.size,n=="slice"?!0:n=="dice"?!1:d&1,f,g,o,r);else{var s=[];d=Infinity;var t=Math.min(o,r),u=o*r/a.size;if(!(a.size<=0)){a.visitBefore(function(a){a.size*=u});for(a=a.childNodes.slice();a.length;){var v=a[a.length-1];v.size?(s.push(v),u=c(s,t),u<=d?(a.pop(),d=u):(s.pop(),e(s),s.length=0,d=Infinity)):a.pop()}if(e(s))for(d=0;d<s.length;d++)s[d].dy+=r;else for(d=0;d<s.length;d++)s[d].dx+=o}}}if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,a)){var e=this,f=a.nodes[0],g=pv.Mark.stack,h=a.paddingLeft,i=a.paddingRight,j=a.paddingTop,k=a.paddingBottom,l=function(a){return a.size},m=a.round?Math.round:Number,n=a.mode;g.unshift(null),f.visitAfter(function(a,b){a.depth=b,a.x=a.y=a.dx=a.dy=0,a.size=a.firstChild?pv.sum(a.childNodes,function(a){return a.size}):e.$size.apply(e,(g[0]=a,g))}),g.shift();switch(a.order){case"ascending":f.sort(function(a,b){return a.size-b.size});break;case"descending":f.sort(function(a,b){return b.size-a.size});break;case"reverse":f.reverse()}f.x=0,f.y=0,f.dx=a.width,f.dy=a.height,f.visitBefore(d)}},pv.Layout.Tree=function(){pv.Layout.Hierarchy.call(this)},pv.Layout.Tree.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("breadth",Number).property("depth",Number).property("orient",String),pv.Layout.Tree.prototype.defaults=(new pv.Layout.Tree).extend(pv.Layout.Hierarchy.prototype.defaults).group(1).breadth(15).depth(60).orient("top"),pv.Layout.Tree.prototype.buildImplied=function(a){function b(a){var c,e,f;if(a.firstChild){c=a.firstChild,e=a.lastChild;for(var g=f=c;g;g=g.nextSibling)b(g),f=d(g,f);h(a),e=.5*(c.prelim+e.prelim),(c=a.previousSibling)?(a.prelim=c.prelim+j(a.depth,!0),a.mod=a.prelim-e):a.prelim=e}else if(c=a.previousSibling)a.prelim=c.prelim+j(a.depth,!0)}function c(a,b,d){a.breadth=a.prelim+b,b+=a.mod;for(a=a.firstChild;a;a=a.nextSibling)c(a,b,d)}function d(a,b){var c=a.previousSibling;if(c){var d=a,h=a,k=c;c=a.parentNode.firstChild;var l=d.mod,m=h.mod,n=k.mod,o=c.mod;k=f(k);for(d=e(d);k&&d;){k=k,d=d,c=e(c),h=f(h),h.ancestor=a;var p=k.prelim+n-(d.prelim+l)+j(k.depth,!1);p>0&&(g(i(k,a,b),a,p),l+=p,m+=p),n+=k.mod,l+=d.mod,o+=c.mod,m+=h.mod,k=f(k),d=e(d)}k&&!f(h)&&(h.thread=k,h.mod+=n-m),d&&!e(c)&&(c.thread=d,c.mod+=l-o,b=a)}return b}function e(a){return a.firstChild||a.thread}function f(a){return a.lastChild||a.thread}function g(a,b,c){var d=b.number-a.number;b.change-=c/d,b.shift+=c,a.change+=c/d,b.prelim+=c,b.mod+=c}function h(a){var b=0,c=0;for(a=a.lastChild;a;a=a.previousSibling)a.prelim+=b,a.mod+=b,c+=a.change,b+=a.shift+c}function i(a,b,c){return a.ancestor.parentNode==b.parentNode?a.ancestor:c}function j(a,b){return(b?1:q+1)/(n=="radial"?a:1)}function k(a){return n=="radial"?a.breadth/o:0}function l(a){switch(n){case"left":return a.depth;case"right":return r-a.depth;case"top":case"bottom":return a.breadth+r/2;case"radial":return r/2+a.depth*Math.cos(k(a))}}function m(a){switch(n){case"left":case"right":return a.breadth+s/2;case"top":return a.depth;case"bottom":return s-a.depth;case"radial":return s/2+a.depth*Math.sin(k(a))}}if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,a)){var n=a.orient,o=a.depth,p=a.breadth,q=a.group,r=a.width,s=a.height;a=a.nodes[0],a.visitAfter(function(a,b){a.ancestor=a,a.prelim=0,a.mod=0,a.change=0,a.shift=0,a.number=a.previousSibling?a.previousSibling.number+1:0,a.depth=b}),b(a),c(a,-a.prelim,0),a.visitAfter(function(a){a.breadth*=p,a.depth*=o,a.midAngle=k(a),a.x=l(a),a.y=m(a),a.firstChild&&(a.midAngle+=Math.PI),delete a.breadth,delete a.depth,delete a.ancestor,delete a.prelim,delete a.mod,delete a.change,delete a.shift,delete a.number,delete a.thread})}},pv.Layout.Indent=function(){pv.Layout.Hierarchy.call(this),this.link.interpolate("step-after")},pv.Layout.Indent.prototype=pv.extend(pv.Layout.Hierarchy).property("depth",Number).property("breadth",Number),pv.Layout.Indent.prototype.defaults=(new pv.Layout.Indent).extend(pv.Layout.Hierarchy.prototype.defaults).depth(15).breadth(15),pv.Layout.Indent.prototype.buildImplied=function(a){function b(a,i,j){a.x=e+j++*d,a.y=f+i++*c,a.midAngle=0;for(a=a.firstChild;a;a=a.nextSibling)i=b(a,i,j);return i}if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,a)){var c=a.breadth,d=a.depth,e=0,f=0;b(a.nodes[0],1,1)}},pv.Layout.Pack=function(){pv.Layout.Hierarchy.call(this),this.node.radius(function(a){return a.radius}).strokeStyle("rgb(31, 119, 180)").fillStyle("rgba(31, 119, 180, .25)"),this.label.textAlign("center"),delete this.link},pv.Layout.Pack.prototype=pv.extend(pv.Layout.Hierarchy).property("spacing",Number).property("order",String),pv.Layout.Pack.prototype.defaults=(new pv.Layout.Pack).extend(pv.Layout.Hierarchy.prototype.defaults).spacing(1).order("ascending"),pv.Layout.Pack.prototype.$radius=function(){return 1},pv.Layout.Pack.prototype.size=function(a){return this.$radius=typeof a=="function"?function(){return Math.sqrt(a.apply(this,arguments))}:(a=Math.sqrt(a),function(){return a}),this},pv.Layout.Pack.prototype.buildImplied=function(a){function b(a){var b=pv.Mark.stack;b.unshift(null);for(var c=0,d=a.length;c<d;c++){var e=a[c];e.firstChild||(e.radius=g.$radius.apply(g,(b[0]=e,b)))}b.shift()}function c(b){var e=[];for(b=b.firstChild;b;b=b.nextSibling)b.firstChild&&(b.radius=c(b)),b.n=b.p=b,e.push(b);switch(a.order){case"ascending":e.sort(function(a,b){return a.radius-b.radius});break;case"descending":e.sort(function(a,b){return b.radius-a.radius});break;case"reverse":e.reverse()}return d(e)}function d(b){function c(a){h=Math.min(a.x-a.radius,h),i=Math.max(a.x+a.radius,i),j=Math.min(a.y-a.radius,j),k=Math.max(a.y+a.radius,k)}function d(a,b){var c=a.n;a.n=b,b.p=a,b.n=c,c.p=b}function f(a,b){a.n=b,b.p=a}function g(a,b){var c=b.x-a.x,d=b.y-a.y;return a=a.radius+b.radius,a*a-c*c-d*d>.001}var h=Infinity,i=-Infinity,j=Infinity,k=-Infinity,l,m,n,o,p;l=b[0],l.x=-l.radius,l.y=0,c(l);if(b.length>1){m=b[1],m.x=m.radius,m.y=0,c(m);if(b.length>2){n=b[2],e(l,m,n),c(n),d(l,n),l.p=n,d(n,m),m=l.n;for(var q=3;q<b.length;q++){e(l,m,n=b[q]);var r=0,s=1,t=1;for(o=m.n;o!=m;o=o.n,s++)if(g(o,n)){r=1;break}if(r==1)for(p=l.p;p!=o.p;p=p.p,t++)if(g(p,n)){t<s&&(r=-1,o=p);break}r==0?(d(l,n),m=n,c(n)):r>0?(f(l,o),m=o,q--):r<0&&(f(o,m),l=o,q--)}}}l=(h+i)/2,m=(j+k)/2;for(q=n=0;q<b.length;q++)o=b[q],o.x-=l,o.y-=m,n=Math.max(n,o.radius+Math.sqrt(o.x*o.x+o.y*o.y));return n+a.spacing}function e(a,b,c){var d=b.radius+c.radius,e=a.radius+c.radius,f=b.x-a.x;b=b.y-a.y;var g=Math.sqrt(f*f+b*b),h=(e*e+g*g-d*d)/(2*e*g);d=Math.acos(h),h*=e,e=Math.sin(d)*e,f/=g,b/=g,c.x=a.x+h*f+e*b,c.y=a.y+h*b-e*f}function f(a,b,c,d){for(var e=a.firstChild;e;e=e.nextSibling)e.x+=a.x,e.y+=a.y,f(e,b,c,d);a.x=b+d*a.x,a.y=c+d*a.y,a.radius*=d}if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,a)){var g=this,h=a.nodes,i=h[0];b(h),i.x=0,i.y=0,i.radius=c(i),h=this.width();var j=this.height(),k=1/Math.max(2*i.radius/h,2*i.radius/j);f(i,h/2,j/2,k)}},pv.Layout.Force=function(){pv.Layout.Network.call(this),this.link.lineWidth(function(a,b){return Math.sqrt(b.linkValue)*1.5}),this.label.textAlign("center")},pv.Layout.Force.prototype=pv.extend(pv.Layout.Network).property("bound",Boolean).property("iterations",Number).property("dragConstant",Number).property("chargeConstant",Number).property("chargeMinDistance",Number).property("chargeMaxDistance",Number).property("chargeTheta",Number).property("springConstant",Number).property("springDamping",Number).property("springLength",Number),pv.Layout.Force.prototype.defaults=(new pv.Layout.Force).extend(pv.Layout.Network.prototype.defaults).dragConstant(.1).chargeConstant(-40).chargeMinDistance(2).chargeMaxDistance(500).chargeTheta(.9).springConstant(.1).springDamping(.3).springLength(20),pv.Layout.Force.prototype.buildImplied=function(a){function b(a){return a.fix?1:a.vx*a.vx+a.vy*a.vy}if(pv.Layout.Network.prototype.buildImplied.call(this,a)){if(a=a.$force)a.next=this.binds.$force,this.binds.$force=a}else{for(var c=this,d=a.nodes,e=a.links,f=a.iterations,g=a.width,h=a.height,i=0,j;i<d.length;i++)j=d[i],isNaN(j.x)&&(j.x=g/2+40*Math.random()-20),isNaN(j.y)&&(j.y=h/2+40*Math.random()-20);j=pv.simulation(d),j.force(pv.Force.drag(a.dragConstant)),j.force(pv.Force.charge(a.chargeConstant).domain(a.chargeMinDistance,a.chargeMaxDistance).theta(a.chargeTheta)),j.force(pv.Force.spring(a.springConstant).damping(a.springDamping).length(a.springLength).links(e)),j.constraint(pv.Constraint.position()),a.bound&&j.constraint(pv.Constraint.bound().x(6,g-6).y(6,h-6));if(f==null)j.step(),j.step(),a.$force=this.binds.$force={next:this.binds.$force,nodes:d,min:1e-4*(e.length+1),sim:j},this.$timer||(this.$timer=setInterval(function(){for(var a=!1,d=c.binds.$force;d;d=d.next)pv.max(d.nodes,b)>d.min&&(d.sim.step(),a=!0);a&&c.render()},42));else for(i=0;i<f;i++)j.step()}},pv.Layout.Cluster=function(){pv.Layout.Hierarchy.call(this);var a,b=this.buildImplied;this.buildImplied=function(d){b.call(this,d),a=/^(top|bottom)$/.test(d.orient)?"step-before":/^(left|right)$/.test(d.orient)?"step-after":"linear"},this.link.interpolate(function(){return a})},pv.Layout.Cluster.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("orient",String).property("innerRadius",Number).property("outerRadius",Number),pv.Layout.Cluster.prototype.defaults=(new pv.Layout.Cluster).extend(pv.Layout.Hierarchy.prototype.defaults).group(0).orient("top"),pv.Layout.Cluster.prototype.buildImplied=function(a){if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,a)){var b=a.nodes[0],c=a.group,d,e,f=0,g=.5-c/2,h=undefined;b.visitAfter(function(a){a.firstChild?a.depth=1+pv.max(a.childNodes,function(a){return a.depth}):(c&&h!=a.parentNode&&(h=a.parentNode,f+=c),f++,a.depth=0)}),d=1/f,e=1/b.depth,h=undefined,b.visitAfter(function(a){a.firstChild?a.breadth=pv.mean(a.childNodes,function(a){return a.breadth}):(c&&h!=a.parentNode&&(h=a.parentNode,g+=c),a.breadth=d*g++),a.depth=1-a.depth*e}),b.visitAfter(function(a){a.minBreadth=a.firstChild?a.firstChild.minBreadth:a.breadth-d/2,a.maxBreadth=a.firstChild?a.lastChild.maxBreadth:a.breadth+d/2}),b.visitBefore(function(a){a.minDepth=a.parentNode?a.parentNode.maxDepth:0,a.maxDepth=a.parentNode?a.depth+b.depth:a.minDepth+2*b.depth}),b.minDepth=-e,pv.Layout.Hierarchy.NodeLink.buildImplied.call(this,a)}},pv.Layout.Cluster.Fill=function(){pv.Layout.Cluster.call(this),pv.Layout.Hierarchy.Fill.constructor.call(this)},pv.Layout.Cluster.Fill.prototype=pv.extend(pv.Layout.Cluster),pv.Layout.Cluster.Fill.prototype.buildImplied=function(a){pv.Layout.Cluster.prototype.buildImplied.call(this,a)||pv.Layout.Hierarchy.Fill.buildImplied.call(this,a)},pv.Layout.Partition=function(){pv.Layout.Hierarchy.call(this)},pv.Layout.Partition.prototype=pv.extend(pv.Layout.Hierarchy).property("order",String).property("orient",String).property("innerRadius",Number).property("outerRadius",Number),pv.Layout.Partition.prototype.defaults=(new pv.Layout.Partition).extend(pv.Layout.Hierarchy.prototype.defaults).orient("top"),pv.Layout.Partition.prototype.$size=function(){return 1},pv.Layout.Partition.prototype.size=function(a){return this.$size=a,this},pv.Layout.Partition.prototype.buildImplied=function(a){if(!pv.Layout
.Hierarchy.prototype.buildImplied.call(this,a)){var b=this,c=a.nodes[0],d=pv.Mark.stack,e=0;d.unshift(null),c.visitAfter(function(a,c){c>e&&(e=c),a.size=a.firstChild?pv.sum(a.childNodes,function(a){return a.size}):b.$size.apply(b,(d[0]=a,d))}),d.shift();switch(a.order){case"ascending":c.sort(function(a,b){return a.size-b.size});break;case"descending":c.sort(function(a,b){return b.size-a.size})}var f=1/e;c.minBreadth=0,c.breadth=.5,c.maxBreadth=1,c.visitBefore(function(a){for(var b=a.minBreadth,c=a.maxBreadth-b,d=a.firstChild;d;d=d.nextSibling)d.minBreadth=b,d.maxBreadth=b+=d.size/a.size*c,d.breadth=(b+d.minBreadth)/2}),c.visitAfter(function(a,b){a.minDepth=(b-1)*f,a.maxDepth=a.depth=b*f}),pv.Layout.Hierarchy.NodeLink.buildImplied.call(this,a)}},pv.Layout.Partition.Fill=function(){pv.Layout.Partition.call(this),pv.Layout.Hierarchy.Fill.constructor.call(this)},pv.Layout.Partition.Fill.prototype=pv.extend(pv.Layout.Partition),pv.Layout.Partition.Fill.prototype.buildImplied=function(a){pv.Layout.Partition.prototype.buildImplied.call(this,a)||pv.Layout.Hierarchy.Fill.buildImplied.call(this,a)},pv.Layout.Arc=function(){pv.Layout.Network.call(this);var a,b,c,d=this.buildImplied;this.buildImplied=function(e){d.call(this,e),b=e.directed,a=e.orient=="radial"?"linear":"polar",c=e.orient=="right"||e.orient=="top"},this.link.data(function(a){var d=a.sourceNode;return a=a.targetNode,c!=(b||d.breadth<a.breadth)?[d,a]:[a,d]}).interpolate(function(){return a})},pv.Layout.Arc.prototype=pv.extend(pv.Layout.Network).property("orient",String).property("directed",Boolean),pv.Layout.Arc.prototype.defaults=(new pv.Layout.Arc).extend(pv.Layout.Network.prototype.defaults).orient("bottom"),pv.Layout.Arc.prototype.sort=function(a){return this.$sort=a,this},pv.Layout.Arc.prototype.buildImplied=function(a){function b(a){switch(f){case"top":return-Math.PI/2;case"bottom":return Math.PI/2;case"left":return Math.PI;case"right":return 0;case"radial":return(a-.25)*2*Math.PI}}function c(a){switch(f){case"top":case"bottom":return a*i;case"left":return 0;case"right":return i;case"radial":return i/2+k*Math.cos(b(a))}}function d(a){switch(f){case"top":return 0;case"bottom":return j;case"left":case"right":return a*j;case"radial":return j/2+k*Math.sin(b(a))}}if(!pv.Layout.Network.prototype.buildImplied.call(this,a)){var e=a.nodes,f=a.orient,g=this.$sort,h=pv.range(e.length),i=a.width,j=a.height,k=Math.min(i,j)/2;g&&h.sort(function(a,b){return g(e[a],e[b])});for(a=0;a<e.length;a++){var l=e[h[a]],m=l.breadth=(a+.5)/e.length;l.x=c(m),l.y=d(m),l.midAngle=b(m)}}},pv.Layout.Horizon=function(){pv.Layout.call(this);var a=this,b,c,d,e,f,g,h=this.buildImplied;this.buildImplied=function(a){h.call(this,a),b=a.bands,c=a.mode,d=Math.round((c=="color"?.5:1)*a.height),e=a.backgroundStyle,f=pv.ramp(e,a.negativeStyle).domain(0,b),g=pv.ramp(e,a.positiveStyle).domain(0,b)},b=(new pv.Panel).data(function(){return pv.range(b*2)}).overflow("hidden").height(function(){return d}).top(function(a){return c=="color"?(a&1)*d:0}).fillStyle(function(a){return a?null:e}),this.band=(new pv.Mark).top(function(a,b){return c=="mirror"&&b&1?(b+1>>1)*d:null}).bottom(function(a,b){return c=="mirror"?b&1?null:(b+1>>1)*-d:(b&1||-1)*(b+1>>1)*d}).fillStyle(function(a,b){return(b&1?f:g)((b>>1)+1)}),this.band.add=function(c){return a.add(pv.Panel).extend(b).add(c).extend(this)}},pv.Layout.Horizon.prototype=pv.extend(pv.Layout).property("bands",Number).property("mode",String).property("backgroundStyle",pv.color).property("positiveStyle",pv.color).property("negativeStyle",pv.color),pv.Layout.Horizon.prototype.defaults=(new pv.Layout.Horizon).extend(pv.Layout.prototype.defaults).bands(2).mode("offset").backgroundStyle("white").positiveStyle("#1f77b4").negativeStyle("#d62728"),pv.Layout.Rollup=function(){pv.Layout.Network.call(this);var a=this,b,c,d=a.buildImplied;this.buildImplied=function(a){d.call(this,a),b=a.$rollup.nodes,c=a.$rollup.links},this.node.data(function(){return b}).size(function(a){return a.nodes.length*20}),this.link.interpolate("polar").eccentricity(.8),this.link.add=function(b){return a.add(pv.Panel).data(function(){return c}).add(b).extend(this)}},pv.Layout.Rollup.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean),pv.Layout.Rollup.prototype.x=function(a){return this.$x=pv.functor(a),this},pv.Layout.Rollup.prototype.y=function(a){return this.$y=pv.functor(a),this},pv.Layout.Rollup.prototype.buildImplied=function(a){function b(a){return g[a]+","+h[a]}if(!pv.Layout.Network.prototype.buildImplied.call(this,a)){var c=a.nodes,d=a.links,e=a.directed,f=c.length,g=[],h=[],i=0,j={},k={},l=pv.Mark.stack,m={parent:this};l.unshift(null);for(var n=0;n<f;n++)m.index=n,l[0]=c[n],g[n]=this.$x.apply(m,l),h[n]=this.$y.apply(m,l);l.shift();for(n=0;n<c.length;n++)f=b(n),l=j[f],l||(l=j[f]=pv.extend(c[n]),l.index=i++,l.x=g[n],l.y=h[n],l.nodes=[]),l.nodes.push(c[n]);for(n=0;n<d.length;n++)i=d[n].targetNode,c=j[b(d[n].sourceNode.index)],i=j[b(i.index)],f=!e&&c.index>i.index?i.index+","+c.index:c.index+","+i.index,(l=k[f])||(l=k[f]={sourceNode:c,targetNode:i,linkValue:0,links:[]}),l.links.push(d[n]),l.linkValue+=d[n].linkValue;a.$rollup={nodes:pv.values(j),links:pv.values(k)}}},pv.Layout.Matrix=function(){pv.Layout.Network.call(this);var a,b,c,d,e,f=this.buildImplied;this.buildImplied=function(i){f.call(this,i),a=i.nodes.length,b=i.width/a,c=i.height/a,d=i.$matrix.labels,e=i.$matrix.pairs},this.link.data(function(){return e}).left(function(){return b*(this.index%a)}).top(function(){return c*Math.floor(this.index/a)}).width(function(){return b}).height(function(){return c}).lineWidth(1.5).strokeStyle("#fff").fillStyle(function(a){return a.linkValue?"#555":"#eee"}).parent=this,delete this.link.add,this.label.data(function(){return d}).left(function(){return this.index&1?b*((this.index>>1)+.5):0}).top(function(){return this.index&1?0:c*((this.index>>1)+.5)}).textMargin(4).textAlign(function(){return this.index&1?"left":"right"}).textAngle(function(){return this.index&1?-Math.PI/2:0}),delete this.node},pv.Layout.Matrix.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean),pv.Layout.Matrix.prototype.sort=function(a){return this.$sort=a,this},pv.Layout.Matrix.prototype.buildImplied=function(a){if(!pv.Layout.Network.prototype.buildImplied.call(this,a)){var b=a.nodes,c=a.links,d=this.$sort,e=b.length,f=pv.range(e),g=[],h=[],i={};a.$matrix={labels:g,pairs:h},d&&f.sort(function(a,c){return d(b[a],b[c])});for(var j=0;j<e;j++)for(var k=0;k<e;k++){var l=f[j],m=f[k];h.push(i[l+"."+m]={row:j,col:k,sourceNode:b[l],targetNode:b[m],linkValue:0})}for(j=0;j<e;j++)l=f[j],g.push(b[l],b[l]);for(j=0;j<c.length;j++)g=c[j],e=g.sourceNode.index,f=g.targetNode.index,g=g.linkValue,i[e+"."+f].linkValue+=g,a.directed||(i[f+"."+e].linkValue+=g)}},pv.Layout.Bullet=function(){pv.Layout.call(this);var a=this,b=a.buildImplied,c=a.x=pv.Scale.linear(),d,e,f,g,h;this.buildImplied=function(a){b.call(this,h=a),d=a.orient,e=/^left|right$/.test(d),f=pv.ramp("#bbb","#eee").domain(0,Math.max(1,h.ranges.length-1)),g=pv.ramp("steelblue","lightsteelblue").domain(0,Math.max(1,h.measures.length-1))},(this.range=new pv.Mark).data(function(){return h.ranges}).reverse(!0).left(function(){return d=="left"?0:null}).top(function(){return d=="top"?0:null}).right(function(){return d=="right"?0:null}).bottom(function(){return d=="bottom"?0:null}).width(function(a){return e?c(a):null}).height(function(a){return e?null:c(a)}).fillStyle(function(){return f(this.index)}).antialias(!1).parent=a,(this.measure=new pv.Mark).extend(this.range).data(function(){return h.measures}).left(function(){return d=="left"?0:e?null:this.parent.width()/3.25}).top(function(){return d=="top"?0:e?this.parent.height()/3.25:null}).right(function(){return d=="right"?0:e?null:this.parent.width()/3.25}).bottom(function(){return d=="bottom"?0:e?this.parent.height()/3.25:null}).fillStyle(function(){return g(this.index)}).parent=a,(this.marker=new pv.Mark).data(function(){return h.markers}).left(function(a){return d=="left"?c(a):e?null:this.parent.width()/2}).top(function(a){return d=="top"?c(a):e?this.parent.height()/2:null}).right(function(a){return d=="right"?c(a):null}).bottom(function(a){return d=="bottom"?c(a):null}).strokeStyle("black").shape("bar").angle(function(){return e?0:Math.PI/2}).parent=a,(this.tick=new pv.Mark).data(function(){return c.ticks(7)}).left(function(a){return d=="left"?c(a):null}).top(function(a){return d=="top"?c(a):null}).right(function(a){return d=="right"?c(a):e?null:-6}).bottom(function(a){return d=="bottom"?c(a):e?-8:null}).height(function(){return e?6:null}).width(function(){return e?null:6}).parent=a},pv.Layout.Bullet.prototype=pv.extend(pv.Layout).property("orient",String).property("ranges").property("markers").property("measures").property("maximum",Number),pv.Layout.Bullet.prototype.defaults=(new pv.Layout.Bullet).extend(pv.Layout.prototype.defaults).orient("left").ranges([]).markers([]).measures([]),pv.Layout.Bullet.prototype.buildImplied=function(a){pv.Layout.prototype.buildImplied.call(this,a);var b=this.parent[/^left|right$/.test(a.orient)?"width":"height"]();a.maximum=a.maximum||pv.max([].concat(a.ranges,a.markers,a.measures)),this.x.domain(0,a.maximum).range(0,b)},pv.Behavior={},pv.Behavior.drag=function(){function a(a){e=this.index,d=this.scene;var b=this.mouse();g=((f=a).fix=pv.vector(a.x,a.y)).minus(b),h={x:this.parent.width()-(a.dx||0),y:this.parent.height()-(a.dy||0)},d.mark.context(d,e,function(){this.render()}),pv.Mark.dispatch("dragstart",d,e)}function b(){d&&(d.mark.context(d,e,function(){var a=this.mouse();f.x=f.fix.x=Math.max(0,Math.min(g.x+a.x,h.x)),f.y=f.fix.y=Math.max(0,Math.min(g.y+a.y,h.y)),this.render()}),pv.Mark.dispatch("drag",d,e))}function c(){d&&(f.fix=null,d.mark.context(d,e,function(){this.render()}),pv.Mark.dispatch("dragend",d,e),d=null)}var d,e,f,g,h;return pv.listen(window,"mousemove",b),pv.listen(window,"mouseup",c),a},pv.Behavior.point=function(a){function b(a,c){a=a[c],c={cost:Infinity};for(var d=0,e=a.visible&&a.children.length;d<e;d++){var f=a.children[d],i=f.mark,k;if(i.type=="panel"){i.scene=f;for(var l=0,m=f.length;l<m;l++)i.index=l,k=b(f,l),k.cost<c.cost&&(c=k);delete i.scene,delete i.index}else if(i.$handlers.point){i=i.mouse(),l=0;for(m=f.length;l<m;l++){var n=f[l];k=i.x-n.left-(n.width||0)/2,n=i.y-n.top-(n.height||0)/2;var o=g*k*k+h*n*n;o<c.cost&&(c.distance=k*k+n*n,c.cost=o,c.scene=f,c.index=l)}}}return c}function c(){var a=b(this.scene,this.index);if(a.cost==Infinity||a.distance>i)a=null;if(e){if(a&&e.scene==a.scene&&e.index==a.index)return;pv.Mark.dispatch("unpoint",e.scene,e.index)}if(e=a)pv.Mark.dispatch("point",a.scene,a.index),pv.listen(this.root.canvas(),"mouseout",d)}function d(a){e&&!pv.ancestor(this,a.relatedTarget)&&(pv.Mark.dispatch("unpoint",e.scene,e.index),e=null)}var e,f=null,g=1,h=1,i=arguments.length?a*a:900;return c.collapse=function(a){if(arguments.length){f=String(a);switch(f){case"y":g=1,h=0;break;case"x":g=0,h=1;break;default:h=g=1}return c}return f},c},pv.Behavior.select=function(){function a(a){e=this.index,d=this.scene,g=this.mouse(),f=a,f.x=g.x,f.y=g.y,f.dx=f.dy=0,pv.Mark.dispatch("selectstart",d,e)}function b(){d&&(d.mark.context(d,e,function(){var a=this.mouse();f.x=Math.max(0,Math.min(g.x,a.x)),f.y=Math.max(0,Math.min(g.y,a.y)),f.dx=Math.min(this.width(),Math.max(a.x,g.x))-f.x,f.dy=Math.min(this.height(),Math.max(a.y,g.y))-f.y,this.render()}),pv.Mark.dispatch("select",d,e))}function c(){d&&(pv.Mark.dispatch("selectend",d,e),d=null)}var d,e,f,g;return pv.listen(window,"mousemove",b),pv.listen(window,"mouseup",c),a},pv.Behavior.resize=function(a){function b(b){f=this.index,e=this.scene,h=this.mouse(),g=b;switch(a){case"left":h.x=g.x+g.dx;break;case"right":h.x=g.x;break;case"top":h.y=g.y+g.dy;break;case"bottom":h.y=g.y}pv.Mark.dispatch("resizestart",e,f)}function c(){e&&(e.mark.context(e,f,function(){var a=this.mouse();g.x=Math.max(0,Math.min(h.x,a.x)),g.y=Math.max(0,Math.min(h.y,a.y)),g.dx=Math.min(this.parent.width(),Math.max(a.x,h.x))-g.x,g.dy=Math.min(this.parent.height(),Math.max(a.y,h.y))-g.y,this.render()}),pv.Mark.dispatch("resize",e,f))}function d(){e&&(pv.Mark.dispatch("resizeend",e,f),e=null)}var e,f,g,h;return pv.listen(window,"mousemove",c),pv.listen(window,"mouseup",d),b},pv.Behavior.pan=function(){function a(){e=this.index,d=this.scene,g=pv.vector(pv.event.pageX,pv.event.pageY),f=this.transform(),h=1/(f.k*this.scale),i&&(i={x:(1-f.k)*this.width(),y:(1-f.k)*this.height()})}function b(){d&&(d.mark.context(d,e,function(){var a=f.translate((pv.event.pageX-g.x)*h,(pv.event.pageY-g.y)*h);i&&(a.x=Math.max(i.x,Math.min(0,a.x)),a.y=Math.max(i.y,Math.min(0,a.y))),this.transform(a).render()}),pv.Mark.dispatch("pan",d,e))}function c(){d=null}var d,e,f,g,h,i;return a.bound=function(a){return arguments.length?(i=Boolean(a),this):Boolean(i)},pv.listen(window,"mousemove",b),pv.listen(window,"mouseup",c),a},pv.Behavior.zoom=function(a){function b(){var b=this.mouse(),e=pv.event.wheel*a;b=this.transform().translate(b.x,b.y).scale(e<0?1e3/(1e3-e):(1e3+e)/1e3).translate(-b.x,-b.y),c&&(b.k=Math.max(1,b.k),b.x=Math.max((1-b.k)*this.width(),Math.min(0,b.x)),b.y=Math.max((1-b.k)*this.height(),Math.min(0,b.y))),this.transform(b).render(),pv.Mark.dispatch("zoom",this.scene,this.index)}var c;return arguments.length||(a=1/48),b.bound=function(a){return arguments.length?(c=Boolean(a),this):Boolean(c)},b},pv.Geo=function(){},pv.Geo.projections={mercator:{project:function(a){return{x:a.lng/180,y:a.lat>85?1:a.lat<-85?-1:Math.log(Math.tan(Math.PI/4+pv.radians(a.lat)/2))/Math.PI}},invert:function(a){return{lng:a.x*180,lat:pv.degrees(2*Math.atan(Math.exp(a.y*Math.PI))-Math.PI/2)}}},"gall-peters":{project:function(a){return{x:a.lng/180,y:Math.sin(pv.radians(a.lat))}},invert:function(a){return{lng:a.x*180,lat:pv.degrees(Math.asin(a.y))}}},sinusoidal:{project:function(a){return{x:pv.radians(a.lng)*Math.cos(pv.radians(a.lat))/Math.PI,y:a.lat/90}},invert:function(a){return{lng:pv.degrees(a.x*Math.PI/Math.cos(a.y*Math.PI/2)),lat:a.y*90}}},aitoff:{project:function(a){var b=pv.radians(a.lng);a=pv.radians(a.lat);var c=Math.acos(Math.cos(a)*Math.cos(b/2));return{x:2*(c?Math.cos(a)*Math.sin(b/2)*c/Math.sin(c):0)/Math.PI,y:2*(c?Math.sin(a)*c/Math.sin(c):0)/Math.PI}},invert:function(a){var b=a.y*Math.PI/2;return{lng:pv.degrees(a.x*Math.PI/2/Math.cos(b)),lat:pv.degrees(b)}}},hammer:{project:function(a){var b=pv.radians(a.lng);a=pv.radians(a.lat);var c=Math.sqrt(1+Math.cos(a)*Math.cos(b/2));return{x:2*Math.SQRT2*Math.cos(a)*Math.sin(b/2)/c/3,y:Math.SQRT2*Math.sin(a)/c/1.5}},invert:function(a){var b=a.x*3;a=a.y*1.5;var c=Math.sqrt(1-b*b/16-a*a/4);return{lng:pv.degrees(2*Math.atan2(c*b,2*(2*c*c-1))),lat:pv.degrees(Math.asin(c*a))}}},identity:{project:function(a){return{x:a.lng/180,y:a.lat/90}},invert:function(a){return{lng:a.x*180,lat:a.y*90}}}},pv.Geo.scale=function(a){function b(a){if(!l||a.lng!=l.lng||a.lat!=l.lat)l=a,a=c(a),m={x:i(a.x),y:j(a.y)};return m}function c(a){return h.project({lng:a.lng-k.lng,lat:a.lat})}function d(a){return a=h.invert(a),a.lng+=k.lng,a}var e={x:0,y:0},f={x:1,y:1},g=[],h=pv.Geo.projections.identity,i=pv.Scale.linear(-1,1).range(0,1),j=pv.Scale.linear(-1,1).range(1,0),k={lng:0,lat:0},l,m;return b.x=function(a){return b(a).x},b.y=function(a){return b(a).y},b.ticks={lng:function(a){var b;if(g.length>1){var c=pv.Scale.linear();a==undefined&&(a=10),b=c.domain(g,function(a){return a.lat}).ticks(a),a=c.domain(g,function(a){return a.lng}).ticks(a)}else b=pv.range(-80,81,10),a=pv.range(-180,181,10);return a.map(function(a){return b.map(function(b){return{lat:b,lng:a}})})},lat:function(a){return pv.transpose(b.ticks.lng(a))}},b.invert=function(a){return d({x:i.invert(a.x),y:j.invert(a.y)})},b.domain=function(a,b){if(arguments.length){g=a instanceof Array?arguments.length>1?pv.map(a,b):a:Array.prototype.slice.call(arguments);if(g.length>1){var d=g.map(function(a){return a.lng}),e=g.map(function(a){return a.lat});k={lng:(pv.max(d)+pv.min(d))/2,lat:(pv.max(e)+pv.min(e))/2},d=g.map(c),i.domain(d,function(a){return a.x}),j.domain(d,function(a){return a.y})}else k={lng:0,lat:0},i.domain(-1,1),j.domain(-1,1);return l=null,this}return g},b.range=function(a,b){return arguments.length?(typeof a=="object"?(e={x:Number(a.x),y:Number(a.y)},f={x:Number(b.x),y:Number(b.y)}):(e={x:0,y:0},f={x:Number(a),y:Number(b)}),i.range(e.x,f.x),j.range(f.y,e.y),l=null,this):[e,f]},b.projection=function(a){return arguments.length?(h=typeof a=="string"?pv.Geo.projections[a]||pv.Geo.projections.identity:a,this.domain(g)):a},b.by=function(a){function c(){return b(a.apply(this,arguments))}for(var d in b)c[d]=b[d];return c},arguments.length&&b.projection(a),b}