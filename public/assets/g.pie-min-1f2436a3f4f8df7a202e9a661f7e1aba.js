Raphael.fn.g.piechart=function(a,b,c,d,e){e=e||{};var f=this,g=[],h=this.set(),i=this.set(),j=this.set(),k=[],l=d.length,m=0,n=0,o=0,p=9,q=!0;i.covers=h;if(l==1)j.push(this.circle(a,b,c).attr({fill:this.g.colors[0],stroke:e.stroke||"#fff","stroke-width":e.strokewidth==null?1:e.strokewidth})),h.push(this.circle(a,b,c).attr(this.g.shim)),n=d[0],d[0]={value:d[0],order:0,valueOf:function(){return this.value}},j[0].middle={x:a,y:b},j[0].mangle=180;else{function r(a,b,c,d,e,f){var g=Math.PI/180,h=a+c*Math.cos(-d*g),i=a+c*Math.cos(-e*g),j=a+c/2*Math.cos(-(d+(e-d)/2)*g),k=b+c*Math.sin(-d*g),l=b+c*Math.sin(-e*g),m=b+c/2*Math.sin(-(d+(e-d)/2)*g),n=["M",a,b,"L",h,k,"A",c,c,0,+(Math.abs(e-d)>180),1,i,l,"z"];return n.middle={x:j,y:m},n}for(var s=0;s<l;s++)n+=d[s],d[s]={value:d[s],order:s,valueOf:function(){return this.value}};d.sort(function(a,b){return b.value-a.value});for(s=0;s<l;s++)q&&d[s]*360/n<=1.5&&(p=s,q=!1),s>p&&(q=!1,d[p].value+=d[s],d[p].others=!0,o=d[p].value);l=Math.min(p+1,d.length),o&&d.splice(l)&&(d[p].others=!0);for(s=0;s<l;s++){var t=m-360*d[s]/n/2;s||(m=90-t,t=m-360*d[s]/n/2);if(e.init)var u=r(a,b,1,m,m-360*d[s]/n).join(",");var v=r(a,b,c,m,m-=360*d[s]/n),w=this.path(e.init?u:v).attr({fill:e.colors&&e.colors[s]||this.g.colors[s]||"#666",stroke:e.stroke||"#fff","stroke-width":e.strokewidth==null?1:e.strokewidth,"stroke-linejoin":"round"});w.value=d[s],w.middle=v.middle,w.mangle=t,g.push(w),j.push(w),e.init&&w.animate({path:v.join(",")},+e.init-1||1e3,">")}for(s=0;s<l;s++)w=f.path(g[s].attr("path")).attr(this.g.shim),e.href&&e.href[s]&&w.attr({href:e.href[s]}),w.attr=function(){},h.push(w),j.push(w)}i.hover=function(e,f){f=f||function(){};var g=this;for(var i=0;i<l;i++)(function(h,i,j){var k={sector:h,cover:i,cx:a,cy:b,mx:h.middle.x,my:h.middle.y,mangle:h.mangle,r:c,value:d[j],total:n,label:g.labels&&g.labels[j]};i.mouseover(function(){e.call(k)}).mouseout(function(){f.call(k)})})(j[i],h[i],i);return this},i.each=function(e){var f=this;for(var g=0;g<l;g++)(function(g,h,i){var j={sector:g,cover:h,cx:a,cy:b,x:g.middle.x,y:g.middle.y,mangle:g.mangle,r:c,value:d[i],total:n,label:f.labels&&f.labels[i]};e.call(j)})(j[g],h[g],g);return this},i.click=function(e){var f=this;for(var g=0;g<l;g++)(function(g,h,i){var j={sector:g,cover:h,cx:a,cy:b,mx:g.middle.x,my:g.middle.y,mangle:g.mangle,r:c,value:d[i],total:n,label:f.labels&&f.labels[i]};h.click(function(){e.call(j)})})(j[g],h[g],g);return this},i.inject=function(a){a.insertBefore(h[0])};var x=function(g,k,m,o){var p=a+c+c/5,q=b,r=q+10;g=g||[],o=o&&o.toLowerCase&&o.toLowerCase()||"east",m=f.g.markers[m&&m.toLowerCase()]||"disc",i.labels=f.set();for(var s=0;s<l;s++){var t=j[s].attr("fill"),u=d[s].order,v;d[s].others&&(g[u]=k||"Others"),g[u]=f.g.labelise(g[u],d[s],n),i.labels.push(f.set()),i.labels[s].push(f.g[m](p+5,r,5).attr({fill:t,stroke:"none"})),i.labels[s].push(v=f.text(p+20,r,g[u]||d[u]).attr(f.g.txtattr).attr({fill:e.legendcolor||"#000","text-anchor":"start"})),h[s].label=i.labels[s],r+=v.getBBox().height*1.2}var w=i.labels.getBBox(),x={east:[0,-w.height/2],west:[-w.width-2*c-20,-w.height/2],north:[-c-w.width/2,-c-w.height-10],south:[-c-w.width/2,c+10]}[o];i.labels.translate.apply(i.labels,x),i.push(i.labels)};return e.legend&&x(e.legend,e.legendothers,e.legendmark,e.legendpos),i.push(j,h),i.series=j,i.covers=h,i}